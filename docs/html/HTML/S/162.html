<html>
<head>
<title>src/arch/_desc.s</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/164.html'>src</a>/<a href='../files/165.html'>arch</a>/_desc.s</h2>
<i><font color='green'>/* [&lt;][&gt;][^][v][top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<pre>
<a name='L1'>   1 ;;
<a name='L2'>   2 ;;  desc.asm
<a name='L3'>   3 ;;
<a name='L4'>   4 ;;  Author:
<a name='L5'>   5 ;;       Antonio Natale &lt;inferdevil97@gmail.com&gt;
<a name='L6'>   6 ;;
<a name='L7'>   7 ;;  Copyright (c) 2014 WareX
<a name='L8'>   8 ;;
<a name='L9'>   9 ;;  This program is free software: you can redistribute it and/or modify
<a name='L10'>  10 ;;  it under the terms of the GNU General Public License as published by
<a name='L11'>  11 ;;  the Free Software Foundation, either version 3 of the License, or
<a name='L12'>  12 ;;  (at your option) any later version.
<a name='L13'>  13 ;;
<a name='L14'>  14 ;;  This program is distributed in the hope that it will be useful,
<a name='L15'>  15 ;;  but WITHOUT ANY WARRANTY; without even the implied warranty of
<a name='L16'>  16 ;;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<a name='L17'>  17 ;;  GNU General Public License for more details.
<a name='L18'>  18 ;;
<a name='L19'>  19 ;;  You should have received a copy of the GNU General Public License
<a name='L20'>  20 ;;  along with this program.  If not, see &lt;http:<i><font color='green'>//www.gnu.org/licenses/&gt;.</font></i>
<a name='L21'>  21 
<a name='L22'>  22 [BITS 32]
<a name='L23'>  23 
<a name='L24'>  24 
<a name='L25'>  25 extern isr_handler
<a name='L26'>  26 extern irq_handler
<a name='L27'>  27 
<a name='L28'>  28 %macro ISRNC 1
<a name='L29'>  29         global isr%1
<a name='L30'>  30         isr%1:
<a name='L31'>  31                 push dword 0
<a name='L32'>  32                 push dword %1
<a name='L33'>  33                 jmp isr_stub
<a name='L34'>  34 %endmacro
<a name='L35'>  35 
<a name='L36'>  36 %macro ISREC 1
<a name='L37'>  37         global isr%1
<a name='L38'>  38         isr%1:
<a name='L39'>  39                 push dword %1
<a name='L40'>  40                 jmp isr_stub
<a name='L41'>  41 %endmacro
<a name='L42'>  42 
<a name='L43'>  43 %macro IRQ 1
<a name='L44'>  44         global irq%1
<a name='L45'>  45         irq%1:
<a name='L46'>  46                 push dword 0
<a name='L47'>  47                 push dword (%1 + 32)
<a name='L48'>  48                 jmp irq_stub
<a name='L49'>  49 %endmacro
<a name='L50'>  50 
<a name='L51'>  51 ISRNC 0
<a name='L52'>  52 ISRNC 1
<a name='L53'>  53 ISRNC 2
<a name='L54'>  54 ISRNC 3
<a name='L55'>  55 ISRNC 4
<a name='L56'>  56 ISRNC 5
<a name='L57'>  57 ISRNC 6
<a name='L58'>  58 ISRNC 7
<a name='L59'>  59 ISREC 8
<a name='L60'>  60 ISRNC 9
<a name='L61'>  61 ISREC 10
<a name='L62'>  62 ISREC 11
<a name='L63'>  63 ISREC 12
<a name='L64'>  64 ISREC 13
<a name='L65'>  65 ISRNC 15
<a name='L66'>  66 ISRNC 16
<a name='L67'>  67 ISRNC 17
<a name='L68'>  68 ISRNC 18
<a name='L69'>  69 ISRNC 19
<a name='L70'>  70 ISRNC 20
<a name='L71'>  71 ISRNC 21
<a name='L72'>  72 ISRNC 22
<a name='L73'>  73 ISRNC 23
<a name='L74'>  74 ISRNC 24
<a name='L75'>  75 ISRNC 25
<a name='L76'>  76 ISRNC 26
<a name='L77'>  77 ISRNC 27
<a name='L78'>  78 ISRNC 28
<a name='L79'>  79 ISRNC 29
<a name='L80'>  80 ISRNC 30
<a name='L81'>  81 ISRNC 31
<a name='L82'>  82 
<a name='L83'>  83 
<a name='L84'>  84 IRQ 0
<a name='L85'>  85 IRQ 1
<a name='L86'>  86 IRQ 2
<a name='L87'>  87 IRQ 3
<a name='L88'>  88 IRQ 4
<a name='L89'>  89 IRQ 5
<a name='L90'>  90 IRQ 6
<a name='L91'>  91 IRQ 7
<a name='L92'>  92 IRQ 8
<a name='L93'>  93 IRQ 9
<a name='L94'>  94 IRQ 10
<a name='L95'>  95 IRQ 11
<a name='L96'>  96 IRQ 12
<a name='L97'>  97 IRQ 13
<a name='L98'>  98 IRQ 14
<a name='L99'>  99 IRQ 15
<a name='L100'> 100 
<a name='L101'> 101 
<a name='L102'> 102 
<a name='L103'> 103 
<a name='L104'> 104 extern syscall_handler
<a name='L105'> 105 extern __errno
<a name='L106'> 106 
<a name='L107'> 107 global isr0x80
<a name='L108'> 108 
<a name='L109'> 109 syscall_retval dd 0
<a name='L110'> 110 
<a name='L111'> 111 isr0x80:
<a name='L112'> 112         sti
<a name='L113'> 113         pusha
<a name='L114'> 114         push ds
<a name='L115'> 115         push es
<a name='L116'> 116         push fs
<a name='L117'> 117         push gs
<a name='L118'> 118         
<a name='L119'> 119         mov eax, 0x10
<a name='L120'> 120         mov ds, eax
<a name='L121'> 121         mov fs, eax
<a name='L122'> 122         mov es, eax
<a name='L123'> 123         mov gs, eax
<a name='L124'> 124         
<a name='L125'> 125 
<a name='L126'> 126         mov eax, esp
<a name='L127'> 127         push eax
<a name='L128'> 128         call syscall_handler
<a name='L129'> 129         mov [syscall_retval], eax
<a name='L130'> 130         pop eax
<a name='L131'> 131         
<a name='L132'> 132         pop gs
<a name='L133'> 133         pop fs
<a name='L134'> 134         pop es
<a name='L135'> 135         pop ds
<a name='L136'> 136         popa
<a name='L137'> 137         sti
<a name='L138'> 138         
<a name='L139'> 139         call __errno
<a name='L140'> 140         mov ebx, [eax]
<a name='L141'> 141         mov eax, [syscall_retval]
<a name='L142'> 142 iret
<a name='L143'> 143         
<a name='L144'> 144         
<a name='L145'> 145 extern pagefault_handler
<a name='L146'> 146 global isr14    
<a name='L147'> 147         
<a name='L148'> 148 isr14:
<a name='L149'> 149         push byte 14
<a name='L150'> 150         pusha
<a name='L151'> 151         push ds
<a name='L152'> 152         push es
<a name='L153'> 153         push fs
<a name='L154'> 154         push gs
<a name='L155'> 155         
<a name='L156'> 156         mov ax, 0x10
<a name='L157'> 157         mov ds, ax
<a name='L158'> 158         mov es, ax
<a name='L159'> 159         mov fs, ax
<a name='L160'> 160         mov gs, ax
<a name='L161'> 161         
<a name='L162'> 162         mov eax, esp
<a name='L163'> 163         push eax
<a name='L164'> 164         call pagefault_handler
<a name='L165'> 165         pop eax
<a name='L166'> 166 
<a name='L167'> 167         pop gs
<a name='L168'> 168         pop fs
<a name='L169'> 169         pop es
<a name='L170'> 170         pop ds
<a name='L171'> 171         popa
<a name='L172'> 172         add esp, 8
<a name='L173'> 173         sti
<a name='L174'> 174 iret
<a name='L175'> 175         
<a name='L176'> 176         
<a name='L177'> 177 global read_eip
<a name='L178'> 178 read_eip:
<a name='L179'> 179         pop eax
<a name='L180'> 180         jmp eax
<a name='L181'> 181 
<a name='L182'> 182 
<a name='L183'> 183                 
<a name='L184'> 184                 
<a name='L185'> 185                 
<a name='L186'> 186 global isr_stub 
<a name='L187'> 187 isr_stub:                       
<a name='L188'> 188         pusha
<a name='L189'> 189         push ds
<a name='L190'> 190         push es
<a name='L191'> 191         push fs
<a name='L192'> 192         push gs
<a name='L193'> 193                 
<a name='L194'> 194         mov ax, 0x10            
<a name='L195'> 195         mov ds, ax                      
<a name='L196'> 196         mov es, ax                      
<a name='L197'> 197         mov fs, ax                      
<a name='L198'> 198         mov gs, ax                      
<a name='L199'> 199                 
<a name='L200'> 200         push esp                        
<a name='L201'> 201         call isr_handler        
<a name='L202'> 202         add esp, 4      
<a name='L203'> 203         
<a name='L204'> 204         pop gs
<a name='L205'> 205         pop fs
<a name='L206'> 206         pop es
<a name='L207'> 207         pop ds
<a name='L208'> 208         popa
<a name='L209'> 209         add esp, 8                      
<a name='L210'> 210         sti     
<a name='L211'> 211 iret
<a name='L212'> 212                 
<a name='L213'> 213                 
<a name='L214'> 214                 
<a name='L215'> 215                 
<a name='L216'> 216                 
<a name='L217'> 217                 
<a name='L218'> 218 global irq_stub 
<a name='L219'> 219 irq_stub:                       
<a name='L220'> 220         pusha
<a name='L221'> 221         push ds
<a name='L222'> 222         push es
<a name='L223'> 223         push fs
<a name='L224'> 224         push gs
<a name='L225'> 225                 
<a name='L226'> 226         mov ax, 0x10            
<a name='L227'> 227         mov ds, ax                      
<a name='L228'> 228         mov es, ax                      
<a name='L229'> 229         mov fs, ax                      
<a name='L230'> 230         mov gs, ax                      
<a name='L231'> 231                 
<a name='L232'> 232                         
<a name='L233'> 233         push esp                        
<a name='L234'> 234         call irq_handler        
<a name='L235'> 235         add esp, 4              
<a name='L236'> 236 
<a name='L237'> 237         pop gs
<a name='L238'> 238         pop fs
<a name='L239'> 239         pop es
<a name='L240'> 240         pop ds
<a name='L241'> 241         popa
<a name='L242'> 242         add esp, 8              
<a name='L243'> 243         sti     
<a name='L244'> 244 iret
<a name='L245'> 245 
<a name='L246'> 246         
<a name='L247'> 247 
<a name='L248'> 248 
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;][^][v]<a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
