<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>aPlus: src/syscall/fcntl.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">aPlus
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Akernelproject</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('fcntl_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fcntl.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="aplus_8h_source.html">aplus.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="fs_8h_source.html">aplus/fs.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="syscall_8h_source.html">aplus/syscall.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="task_8h_source.html">aplus/task.h</a>&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;<a class="el" href="dirent_8h_source.html">dirent.h</a>&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
</div>
<p><a href="fcntl_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7d46f514aa7d9664ebd2baa4d61c4a37"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fcntl_8c.html#a7d46f514aa7d9664ebd2baa4d61c4a37">sys_fcntl</a> (int fd, int request, void *buf)</td></tr>
<tr class="memdesc:a7d46f514aa7d9664ebd2baa4d61c4a37"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function shall perform the operations described below on open files.<br />
 The available values for cmd are defined in &lt;fcntl.h&gt; and are as follows.  <a href="#a7d46f514aa7d9664ebd2baa4d61c4a37">More...</a><br /></td></tr>
<tr class="separator:a7d46f514aa7d9664ebd2baa4d61c4a37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f500fa48a3ec03f7c9627bc1abda1aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fcntl_8c.html#a5f500fa48a3ec03f7c9627bc1abda1aa">SYSCALL</a> (<a class="el" href="fcntl_8c.html#a7d46f514aa7d9664ebd2baa4d61c4a37">sys_fcntl</a>, 19)</td></tr>
<tr class="separator:a5f500fa48a3ec03f7c9627bc1abda1aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a4743b3673a8794b8e7bd0b6c91a63cd5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="task_8h.html#a8aeef2cdb643462b97cd459a8e68cad3">task_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fcntl_8c.html#a4743b3673a8794b8e7bd0b6c91a63cd5">current_task</a></td></tr>
<tr class="memdesc:a4743b3673a8794b8e7bd0b6c91a63cd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current task address.  <a href="#a4743b3673a8794b8e7bd0b6c91a63cd5">More...</a><br /></td></tr>
<tr class="separator:a4743b3673a8794b8e7bd0b6c91a63cd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9af8258c3554800f6613f8147544225f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="fs_8h.html#a48b686d0c4375b0d1aab2296dc36c7a6">inode_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fcntl_8c.html#a9af8258c3554800f6613f8147544225f">vfs_root</a></td></tr>
<tr class="separator:a9af8258c3554800f6613f8147544225f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a7d46f514aa7d9664ebd2baa4d61c4a37"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sys_fcntl </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function shall perform the operations described below on open files.<br />
 The available values for cmd are defined in &lt;fcntl.h&gt; and are as follows. </p>
<ul>
<li>F_DUPFD<br />
<ul>
<li>Return a new file descriptor which shall be the lowest numbered available (that is, not already open) file descriptor greater than or equal to the third argument, arg, taken as an integer of type int.<br />
 The new file descriptor shall refer to the same open file description as the original file descriptor, and shall share any locks.<br />
 The FD_CLOEXEC flag associated with the new file descriptor shall be cleared to keep the file open across calls to one of the exec functions.<br />
</li>
</ul>
</li>
<li>F_GETFD<br />
<ul>
<li>Get the file descriptor flags defined in &lt;fcntl.h&gt; that are associated with the file descriptor fildes.<br />
 File descriptor flags are associated with a single file descriptor and do not affect other file descriptors that refer to the same file.</li>
</ul>
</li>
<li>F_SETFD<br />
<ul>
<li>Set the file descriptor flags defined in &lt;fcntl.h&gt;, that are associated with fildes, to the third argument, arg, taken as type int.<br />
 If the FD_CLOEXEC flag in the third argument is 0, the file shall remain open across the exec functions; otherwise, the file shall be closed upon successful execution of one of the exec functions.<br />
</li>
</ul>
</li>
<li>F_GETFL<br />
<ul>
<li>Get the file status flags and file access modes, defined in &lt;fcntl.h&gt;, for the file description associated with fildes. The file access modes can be extracted from the return value using the mask O_ACCMODE, which is defined in &lt;fcntl.h&gt;.<br />
 File status flags and file access modes are associated with the file description and do not affect other file descriptors that refer to the same file with different open file descriptions.<br />
</li>
</ul>
</li>
<li>F_SETFL<br />
<ul>
<li>Set the file status flags, defined in &lt;fcntl.h&gt;, for the file description associated with fildes from the corresponding bits in the third argument, arg, taken as type int.<br />
 Bits corresponding to the file access mode and the file creation flags, as defined in &lt;fcntl.h&gt;, that are set in arg shall be ignored. If any bits in arg other than those mentioned here are changed by the application, the result is unspecified.<br />
</li>
</ul>
</li>
<li>F_GETOWN<br />
<ul>
<li>If fildes refers to a socket, get the process or process group ID specified to receive SIGURG signals when out-of-band data is available.<br />
 Positive values indicate a process ID; negative values, other than -1, indicate a process group ID.<br />
 If fildes does not refer to a socket, the results are unspecified.<br />
</li>
</ul>
</li>
<li>F_SETOWN<br />
<ul>
<li>If fildes refers to a socket, set the process or process group ID specified to receive SIGURG signals when out-of-band data is available, using the value of the third argument, arg, taken as type int.<br />
 Positive values indicate a process ID; negative values, other than -1, indicate a process group ID.<br />
 If fildes does not refer to a socket, the results are unspecified<br />
<br />
<br />
<br />
 <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>File descriptor. </td></tr>
    <tr><td class="paramname">request</td><td>Request operation. </td></tr>
    <tr><td class="paramname">buf</td><td>Optional arguments. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Upon successful completion, the value returned shall depend on cmd.<br />
 Otherwise, -1 shall be returned and errno set to indicate the error </dd></dl>
</li>
</ul>
</li>
</ul>

<p>Definition at line <a class="el" href="fcntl_8c_source.html#l00072">72</a> of file <a class="el" href="fcntl_8c_source.html">fcntl.c</a>.</p>

<p>References <a class="el" href="errno_8c_source.html#l00003">errno</a>, <a class="el" href="task_8h_source.html#l00105">task::fd</a>, and <a class="el" href="debug_8c_source.html#l00167">kprintf()</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                                              {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="fcntl_8c.html#a4743b3673a8794b8e7bd0b6c91a63cd5">current_task</a>)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="structinode.html">inode_t</a>* ino = <a class="code" href="fcntl_8c.html#a4743b3673a8794b8e7bd0b6c91a63cd5">current_task</a>-&gt;<a class="code" href="structtask.html#afeeb6bafaefe505e6a730dd4e0be5a1a">fd</a>[fd];</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span>(!ino) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <a class="code" href="errno_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EBADF;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">/* TODO */</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <a class="code" href="debug_8c.html#ac9d768b4772cc87fc88afbbbd805f96a">kprintf</a>(<span class="stringliteral">&quot;sys_chown: TODO.&quot;</span>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="errno_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = ENOSYS;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;}</div>
<div class="ttc" id="debug_8c_html_ac9d768b4772cc87fc88afbbbd805f96a"><div class="ttname"><a href="debug_8c.html#ac9d768b4772cc87fc88afbbbd805f96a">kprintf</a></div><div class="ttdeci">void kprintf(char *fmt,...)</div><div class="ttdoc">Formatted output conversion and print to Debug Standard Output. </div><div class="ttdef"><b>Definition:</b> <a href="debug_8c_source.html#l00167">debug.c:167</a></div></div>
<div class="ttc" id="structinode_html"><div class="ttname"><a href="structinode.html">inode</a></div><div class="ttdef"><b>Definition:</b> <a href="fs_8h_source.html#l00037">fs.h:37</a></div></div>
<div class="ttc" id="errno_8c_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="errno_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div><div class="ttdef"><b>Definition:</b> <a href="errno_8c_source.html#l00003">errno.c:3</a></div></div>
<div class="ttc" id="fcntl_8c_html_a4743b3673a8794b8e7bd0b6c91a63cd5"><div class="ttname"><a href="fcntl_8c.html#a4743b3673a8794b8e7bd0b6c91a63cd5">current_task</a></div><div class="ttdeci">task_t * current_task</div><div class="ttdoc">Current task address. </div><div class="ttdef"><b>Definition:</b> <a href="src_2sched_8c_source.html#l00035">sched.c:35</a></div></div>
<div class="ttc" id="structtask_html_afeeb6bafaefe505e6a730dd4e0be5a1a"><div class="ttname"><a href="structtask.html#afeeb6bafaefe505e6a730dd4e0be5a1a">task::fd</a></div><div class="ttdeci">inode_t * fd[TASK_MAX_FD]</div><div class="ttdef"><b>Definition:</b> <a href="task_8h_source.html#l00105">task.h:105</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5f500fa48a3ec03f7c9627bc1abda1aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">SYSCALL </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fcntl_8c.html#a7d46f514aa7d9664ebd2baa4d61c4a37">sys_fcntl</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">19&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a4743b3673a8794b8e7bd0b6c91a63cd5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="task_8h.html#a8aeef2cdb643462b97cd459a8e68cad3">task_t</a>* current_task</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Current task address. </p>

<p>Definition at line <a class="el" href="src_2sched_8c_source.html#l00035">35</a> of file <a class="el" href="src_2sched_8c_source.html">sched.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9af8258c3554800f6613f8147544225f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="fs_8h.html#a48b686d0c4375b0d1aab2296dc36c7a6">inode_t</a>* vfs_root</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="vfs_8c_source.html#l00019">19</a> of file <a class="el" href="vfs_8c_source.html">vfs.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_0355137e5381b7064e986c544d4a0af5.html">src</a></li><li class="navelem"><a class="el" href="dir_fb5e736bd9710abb23af1a33618053fb.html">syscall</a></li><li class="navelem"><a class="el" href="fcntl_8c.html">fcntl.c</a></li>
    <li class="footer">Generated on Wed Nov 12 2014 17:33:03 for aPlus by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.8 </li>
  </ul>
</div>
</body>
</html>
