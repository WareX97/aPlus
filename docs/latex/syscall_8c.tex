\hypertarget{syscall_8c}{\section{src/arch/syscall.c File Reference}
\label{syscall_8c}\index{src/arch/syscall.\+c@{src/arch/syscall.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/spinlock.\+h$>$}\\*
{\ttfamily \#include $<$aplus/syscall.\+h$>$}\\*
{\ttfamily \#include $<$aplus/attribute.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{syscall_8c_a15662fc3572d9f3abd72a439727767c3}{syscall\+\_\+init} ()
\item 
int \hyperlink{syscall_8c_a271c3526b04dd2fe678f7f0d00cbf759}{syscall\+\_\+invoke} (void $\ast$handler, int p0, int p1, int p2, int p3, int p4)
\item 
int \hyperlink{syscall_8c_a7325ddfa6207debff955f3bcefc0bf93}{syscall\+\_\+handler} (regs\+\_\+t $\ast$r)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static void $\ast$$\ast$ \hyperlink{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}{syscall\+\_\+handlers} = N\+U\+L\+L
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{syscall_8c_a7325ddfa6207debff955f3bcefc0bf93}{\index{syscall.\+c@{syscall.\+c}!syscall\+\_\+handler@{syscall\+\_\+handler}}
\index{syscall\+\_\+handler@{syscall\+\_\+handler}!syscall.\+c@{syscall.\+c}}
\subsubsection[{syscall\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}int syscall\+\_\+handler (
\begin{DoxyParamCaption}
\item[{regs\+\_\+t $\ast$}]{r}
\end{DoxyParamCaption}
)}}\label{syscall_8c_a7325ddfa6207debff955f3bcefc0bf93}


Definition at line 53 of file syscall.\+c.



References syscall\+\_\+handlers, and syscall\+\_\+invoke().


\begin{DoxyCode}
53                                \{
54     \textcolor{keywordflow}{return} \hyperlink{syscall_8c_a271c3526b04dd2fe678f7f0d00cbf759}{syscall\_invoke}(\hyperlink{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}{syscall\_handlers}[r->eax], r->ebx, r->ecx, r->edx, r
      ->esi, r->edi);
55 \}
\end{DoxyCode}
\hypertarget{syscall_8c_a15662fc3572d9f3abd72a439727767c3}{\index{syscall.\+c@{syscall.\+c}!syscall\+\_\+init@{syscall\+\_\+init}}
\index{syscall\+\_\+init@{syscall\+\_\+init}!syscall.\+c@{syscall.\+c}}
\subsubsection[{syscall\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}int syscall\+\_\+init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{syscall_8c_a15662fc3572d9f3abd72a439727767c3}


Definition at line 11 of file syscall.\+c.



References attribute(), \+\_\+\+\_\+syscall\+::handler, kmalloc(), kprintf(), list\+\_\+destroy, list\+\_\+foreach, \+\_\+\+\_\+syscall\+::number, list\+::size, syscall\+\_\+handlers, and value.


\begin{DoxyCode}
11                    \{
12     \hyperlink{structlist}{list\_t}* syslist = \hyperlink{attribute_8h_ab96abe3fdf944e75a2316807105c1b6e}{attribute}(\textcolor{stringliteral}{"syscall"});
13 
14     \hyperlink{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}{syscall\_handlers} = (\textcolor{keywordtype}{void}**) \hyperlink{mm_8h_a1f5d4240b2decc62c0e6eae06c72916c}{kmalloc}(\textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void}*) * syslist->
      \hyperlink{structlist_ae581be90bd8eb7051528b61ad216de88}{size});
15     memset(\hyperlink{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}{syscall\_handlers}, 0, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{void}*) * syslist->\hyperlink{structlist_ae581be90bd8eb7051528b61ad216de88}{size});
16 
17     \hyperlink{list_8h_a1f44c976d2c698407a17fef984a5b232}{list\_foreach}(\hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value}, syslist) \{
18         \hyperlink{struct____syscall}{syscall\_t}* sys = (\hyperlink{struct____syscall}{syscall\_t}*) \hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value};
19 
20         \hyperlink{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}{syscall\_handlers}[sys->\hyperlink{struct____syscall_a7f020a41ed9bf3daff3dfc46ee673eef}{number}] = sys->\hyperlink{struct____syscall_af1d75ee98d8568f74e8421654a1081d3}{handler};
21     \}
22 
23     \hyperlink{debug_8c_ac9d768b4772cc87fc88afbbbd805f96a}{kprintf}(\textcolor{stringliteral}{"syscall: loaded %d handlers\(\backslash\)n"}, syslist->\hyperlink{structlist_ae581be90bd8eb7051528b61ad216de88}{size});
24     \hyperlink{list_8h_a9c676c5a77ee9c18ccaadcb4f99fc990}{list\_destroy}(syslist);
25     \textcolor{keywordflow}{return} 0;
26 \}
\end{DoxyCode}
\hypertarget{syscall_8c_a271c3526b04dd2fe678f7f0d00cbf759}{\index{syscall.\+c@{syscall.\+c}!syscall\+\_\+invoke@{syscall\+\_\+invoke}}
\index{syscall\+\_\+invoke@{syscall\+\_\+invoke}!syscall.\+c@{syscall.\+c}}
\subsubsection[{syscall\+\_\+invoke}]{\setlength{\rightskip}{0pt plus 5cm}int syscall\+\_\+invoke (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{handler, }
\item[{int}]{p0, }
\item[{int}]{p1, }
\item[{int}]{p2, }
\item[{int}]{p3, }
\item[{int}]{p4}
\end{DoxyParamCaption}
)}}\label{syscall_8c_a271c3526b04dd2fe678f7f0d00cbf759}


Definition at line 28 of file syscall.\+c.



References \+\_\+\+\_\+asm\+\_\+\+\_\+(), and errno.


\begin{DoxyCode}
28                                                                           \{
29     \textcolor{keywordflow}{if}(handler == NULL) \{
30         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;
31         \textcolor{keywordflow}{return} -1;
32     \}
33 
34 
35     \textcolor{keywordtype}{int} r = 0;
36 
37     \hyperlink{desc_8c_ad365b1ba0a341f9a84551327fe0dac7b}{\_\_asm\_\_} (
38         \textcolor{stringliteral}{"push ebx           \(\backslash\)n"}
39         \textcolor{stringliteral}{"push ecx           \(\backslash\)n"}
40         \textcolor{stringliteral}{"push edx           \(\backslash\)n"}
41         \textcolor{stringliteral}{"push esi           \(\backslash\)n"}
42         \textcolor{stringliteral}{"push edi           \(\backslash\)n"}
43         \textcolor{stringliteral}{"call eax           \(\backslash\)n"}
44         \textcolor{stringliteral}{"add esp, 20        \(\backslash\)n"}
45         : \textcolor{stringliteral}{"=a"}(r) 
46         : \textcolor{stringliteral}{"a"}(handler), \textcolor{stringliteral}{"b"}(p4), \textcolor{stringliteral}{"c"}(p3), \textcolor{stringliteral}{"d"}(p2), \textcolor{stringliteral}{"S"}(p1), \textcolor{stringliteral}{"D"}(p0)
47     );
48 
49     \textcolor{keywordflow}{return} r;
50 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}{\index{syscall.\+c@{syscall.\+c}!syscall\+\_\+handlers@{syscall\+\_\+handlers}}
\index{syscall\+\_\+handlers@{syscall\+\_\+handlers}!syscall.\+c@{syscall.\+c}}
\subsubsection[{syscall\+\_\+handlers}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$$\ast$ syscall\+\_\+handlers = N\+U\+L\+L\hspace{0.3cm}{\ttfamily [static]}}}\label{syscall_8c_afb85e77f03c9acf2f02687360c17dd91}


Definition at line 9 of file syscall.\+c.

