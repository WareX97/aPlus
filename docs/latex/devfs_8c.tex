\hypertarget{devfs_8c}{\section{src/fs/devfs.c File Reference}
\label{devfs_8c}\index{src/fs/devfs.\+c@{src/fs/devfs.\+c}}
}
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$stddef.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{fs_8h_a48b686d0c4375b0d1aab2296dc36c7a6}{inode\+\_\+t} $\ast$ \hyperlink{devfs_8c_a226c953aff43f9b1e9736908bb6802f3}{devfs\+\_\+getdevice} (dev\+\_\+t dev)
\item 
struct \hyperlink{structinode}{inode} $\ast$ \hyperlink{devfs_8c_a268e4d56ebd88b1227eb40d20b247c03}{devfs\+\_\+creat} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$\hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name}, mode\+\_\+t mode)
\item 
\hyperlink{fs_8h_a48b686d0c4375b0d1aab2296dc36c7a6}{inode\+\_\+t} $\ast$ \hyperlink{devfs_8c_a12b8ede9eeee8603d4b89d189a484380}{devfs\+\_\+mount} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{fs_8h_a48b686d0c4375b0d1aab2296dc36c7a6}{inode\+\_\+t} $\ast$ \hyperlink{devfs_8c_a9af8258c3554800f6613f8147544225f}{vfs\+\_\+root}
\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{devfs_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\+\_\+task}
\begin{DoxyCompactList}\small\item\em Current task address. \end{DoxyCompactList}\item 
\hyperlink{fs_8h_a48b686d0c4375b0d1aab2296dc36c7a6}{inode\+\_\+t} $\ast$ \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{devfs_8c_a268e4d56ebd88b1227eb40d20b247c03}{\index{devfs.\+c@{devfs.\+c}!devfs\+\_\+creat@{devfs\+\_\+creat}}
\index{devfs\+\_\+creat@{devfs\+\_\+creat}!devfs.\+c@{devfs.\+c}}
\subsubsection[{devfs\+\_\+creat}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf inode}$\ast$ devfs\+\_\+creat (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{name, }
\item[{mode\+\_\+t}]{mode}
\end{DoxyParamCaption}
)}}\label{devfs_8c_a268e4d56ebd88b1227eb40d20b247c03}


Definition at line 35 of file devfs.\+c.



References inode\+::atime, inode\+::chown, inode\+::creat, inode\+::ctime, inode\+::dev, inode\+::finddir, inode\+::flush, inode\+::gid, task\+::gid, inode\+::ino, inode\+::ioctl, kmalloc(), inode\+::link, inode\+::mode, inode\+::mtime, inode\+::name, inode\+::nlink, inode\+::parent, inode\+::rdev, inode\+::read, inode\+::readdir, inode\+::rename, inode\+::size, sys\+\_\+time(), inode\+::uid, task\+::uid, inode\+::unlink, vfs\+\_\+map(), vfs\+\_\+mapped(), and inode\+::write.


\begin{DoxyCode}
35                                                                          \{
36     \textcolor{keywordflow}{if}((\textcolor{keywordtype}{void}*) \hyperlink{vfs_8c_a99334446cfc1dfc32088d838b4f2895c}{vfs\_mapped}(inode, \hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name}) != NULL)
37         \textcolor{keywordflow}{return} NULL;
38         
39     \hyperlink{structinode}{inode\_t}* ino = (\hyperlink{structinode}{inode\_t}*) \hyperlink{mm_8h_a1f5d4240b2decc62c0e6eae06c72916c}{kmalloc}(\textcolor{keyword}{sizeof}(\hyperlink{structinode}{inode\_t}));
40     strcpy(ino->\hyperlink{structinode_ad64802d9d4ebdd1c56af5ab6e302faf0}{name}, \hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name});
41     
42     ino->\hyperlink{structinode_a127a2eb030df332fa64a81188731ad6b}{dev} = inode->\hyperlink{structinode_a127a2eb030df332fa64a81188731ad6b}{dev};
43     ino->\hyperlink{structinode_a1a77be0f24a6c9a18bbdbcecfb75df7c}{ino} = 0;
44     ino->\hyperlink{structinode_a4902d9f6a1d7bd79c6f1bb73d83ce8e3}{mode} = mode;
45     ino->\hyperlink{structinode_a1daedc820c86b5af32f0a137419f7a8f}{nlink} = 0;
46     ino->\hyperlink{structinode_a0eac94e96ded19029e871d5cce815bcb}{uid} = \hyperlink{devfs_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_ade8fc4c414bce856dacf9efee3031be8}{uid};
47     ino->\hyperlink{structinode_a8434fb9dd05057d00b37ed713713835d}{gid} = \hyperlink{devfs_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_aaf3b6e15445e766a5c4823b815bca630}{gid};
48     ino->\hyperlink{structinode_a3e7613383954ff7b5faf7c2188e1f61b}{rdev} = ino->\hyperlink{structinode_a3e7613383954ff7b5faf7c2188e1f61b}{rdev};
49     ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size} = (size\_t) 0;
50     ino->\hyperlink{structinode_a7e52661a115f6def97778566f2be0d80}{atime} = ino->\hyperlink{structinode_a27334a9d3c25fbac1c134ed5b9cbc566}{ctime} = ino->\hyperlink{structinode_a19f0d407fa2962c942e406d3e00c1da4}{mtime} = \hyperlink{time_8c_a4b6eba92722ec1e5446f676e95e4cddf}{sys\_time}(NULL);
51     ino->\hyperlink{structinode_a2d4fac4ae14332628e6fa2bd55dd3121}{parent} = inode;
52     ino->\hyperlink{structinode_a3533c53c5391601c66b3ae0f389c0843}{link} = NULL;
53     
54     ino->\hyperlink{structinode_ae2c5e8a0a372334b97024fbd9ef694c1}{read} = NULL;
55     ino->\hyperlink{structinode_a53a123d38834fa17e7ef5c1e5f47bba2}{write} = NULL;
56     ino->\hyperlink{structinode_a0a54c11571f19f23322f3e6ad3ecb113}{readdir} = NULL;
57     ino->\hyperlink{structinode_ab6c5e2d912fdbd506086e53185cd370d}{finddir} = NULL;
58     ino->\hyperlink{structinode_ad622a049b34780786d9ba4311b06b3b4}{creat} = NULL;
59     ino->\hyperlink{structinode_a5a309a9c4ada7e4d062162b06125a929}{rename} = NULL;
60     ino->\hyperlink{structinode_adf65bac80736631b8000d3d34e953aaa}{unlink} = NULL;
61     ino->\hyperlink{structinode_a8221183a697c9f2b4e0e295f5a9d8afd}{chown} = NULL;
62     ino->\hyperlink{structinode_ae2972ef183f5c39aac7cb83b9f8a04a8}{flush} = NULL;
63     ino->\hyperlink{structinode_a636843da203574bc338b016758bf8c7e}{ioctl} = NULL;
64     
65     \hyperlink{vfs_8c_acb87c78588a46c5526e933c495b69c2a}{vfs\_map}(ino);
66     
67     \textcolor{keywordflow}{return} ino;
68 \}
\end{DoxyCode}
\hypertarget{devfs_8c_a226c953aff43f9b1e9736908bb6802f3}{\index{devfs.\+c@{devfs.\+c}!devfs\+\_\+getdevice@{devfs\+\_\+getdevice}}
\index{devfs\+\_\+getdevice@{devfs\+\_\+getdevice}!devfs.\+c@{devfs.\+c}}
\subsubsection[{devfs\+\_\+getdevice}]{\setlength{\rightskip}{0pt plus 5cm}{\bf inode\+\_\+t}$\ast$ devfs\+\_\+getdevice (
\begin{DoxyParamCaption}
\item[{dev\+\_\+t}]{dev}
\end{DoxyParamCaption}
)}}\label{devfs_8c_a226c953aff43f9b1e9736908bb6802f3}


Definition at line 23 of file devfs.\+c.



References inode\+::ino, and vfs\+\_\+mapped\+\_\+at\+\_\+index().


\begin{DoxyCode}
23                                     \{
24     \textcolor{keywordtype}{int} index = 0;
25     \hyperlink{structinode}{inode\_t}* map = NULL;
26 
27     \textcolor{keywordflow}{while}((map = (\hyperlink{structinode}{inode\_t}*) \hyperlink{vfs_8c_a4f7b5f17ac7c4b3a0a574d9620e0512d}{vfs\_mapped\_at\_index}(\hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}, index++)) != NULL)
28         \textcolor{keywordflow}{if}(map->\hyperlink{structinode_a1a77be0f24a6c9a18bbdbcecfb75df7c}{ino} == dev)
29             \textcolor{keywordflow}{return} map;
30     
31     \textcolor{keywordflow}{return} NULL;
32 \}
\end{DoxyCode}
\hypertarget{devfs_8c_a12b8ede9eeee8603d4b89d189a484380}{\index{devfs.\+c@{devfs.\+c}!devfs\+\_\+mount@{devfs\+\_\+mount}}
\index{devfs\+\_\+mount@{devfs\+\_\+mount}!devfs.\+c@{devfs.\+c}}
\subsubsection[{devfs\+\_\+mount}]{\setlength{\rightskip}{0pt plus 5cm}{\bf inode\+\_\+t}$\ast$ devfs\+\_\+mount (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{devfs_8c_a12b8ede9eeee8603d4b89d189a484380}


Definition at line 71 of file devfs.\+c.



References inode\+::atime, inode\+::chown, inode\+::creat, inode\+::ctime, inode\+::dev, devfs, devfs\+\_\+creat(), inode\+::finddir, inode\+::flush, inode\+::gid, G\+I\+D\+\_\+\+R\+O\+O\+T, inode\+::ino, inode\+::ioctl, kmalloc(), inode\+::link, inode\+::mode, inode\+::mtime, inode\+::name, inode\+::nlink, inode\+::parent, inode\+::rdev, inode\+::read, inode\+::readdir, inode\+::rename, inode\+::size, sys\+\_\+time(), inode\+::uid, U\+I\+D\+\_\+\+R\+O\+O\+T, inode\+::unlink, vfs\+\_\+root, and inode\+::write.


\begin{DoxyCode}
71                        \{
72     
73     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs} = (\hyperlink{structinode}{inode\_t}*) \hyperlink{mm_8h_a1f5d4240b2decc62c0e6eae06c72916c}{kmalloc}(\textcolor{keyword}{sizeof}(\hyperlink{structinode}{inode\_t}));
74     strcpy(\hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_ad64802d9d4ebdd1c56af5ab6e302faf0}{name}, \textcolor{stringliteral}{"dev"});
75     
76     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a127a2eb030df332fa64a81188731ad6b}{dev} = (dev\_t) 0;
77     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a1a77be0f24a6c9a18bbdbcecfb75df7c}{ino} = (ino\_t) 0;
78     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a4902d9f6a1d7bd79c6f1bb73d83ce8e3}{mode} = S\_IFDIR;
79     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a1daedc820c86b5af32f0a137419f7a8f}{nlink} = 0;
80     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a0eac94e96ded19029e871d5cce815bcb}{uid} = \hyperlink{fs_8h_a9cf90243a3f4070f29ff12e5740e4ae4}{UID\_ROOT};
81     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a8434fb9dd05057d00b37ed713713835d}{gid} = \hyperlink{fs_8h_a2a5a81b6a48db264d1ec6048268ea154}{GID\_ROOT};
82     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a3e7613383954ff7b5faf7c2188e1f61b}{rdev} = (dev\_t) 0;
83     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size} = (size\_t) 0;
84     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a7e52661a115f6def97778566f2be0d80}{atime} = \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a27334a9d3c25fbac1c134ed5b9cbc566}{ctime} = \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a19f0d407fa2962c942e406d3e00c1da4}{mtime} = 
      \hyperlink{time_8c_a4b6eba92722ec1e5446f676e95e4cddf}{sys\_time}(NULL);
85     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a2d4fac4ae14332628e6fa2bd55dd3121}{parent} = \hyperlink{devfs_8c_a9af8258c3554800f6613f8147544225f}{vfs\_root};
86     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a3533c53c5391601c66b3ae0f389c0843}{link} = NULL;
87     
88     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_ae2c5e8a0a372334b97024fbd9ef694c1}{read} = NULL;
89     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a53a123d38834fa17e7ef5c1e5f47bba2}{write} = NULL;
90     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a0a54c11571f19f23322f3e6ad3ecb113}{readdir} = NULL;
91     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_ab6c5e2d912fdbd506086e53185cd370d}{finddir} = NULL;
92     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_ad622a049b34780786d9ba4311b06b3b4}{creat} = \hyperlink{devfs_8c_a268e4d56ebd88b1227eb40d20b247c03}{devfs\_creat};
93     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a5a309a9c4ada7e4d062162b06125a929}{rename} = NULL;
94     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_adf65bac80736631b8000d3d34e953aaa}{unlink} = NULL;
95     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a8221183a697c9f2b4e0e295f5a9d8afd}{chown} = NULL;
96     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_ae2972ef183f5c39aac7cb83b9f8a04a8}{flush} = NULL;
97     \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs}->\hyperlink{structinode_a636843da203574bc338b016758bf8c7e}{ioctl} = NULL;
98     
99     \textcolor{keywordflow}{return} \hyperlink{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{devfs};
100 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{devfs_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{\index{devfs.\+c@{devfs.\+c}!current\+\_\+task@{current\+\_\+task}}
\index{current\+\_\+task@{current\+\_\+task}!devfs.\+c@{devfs.\+c}}
\subsubsection[{current\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ current\+\_\+task}}\label{devfs_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}


Current task address. 



Definition at line 35 of file sched.\+c.

\hypertarget{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}{\index{devfs.\+c@{devfs.\+c}!devfs@{devfs}}
\index{devfs@{devfs}!devfs.\+c@{devfs.\+c}}
\subsubsection[{devfs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf inode\+\_\+t}$\ast$ devfs}}\label{devfs_8c_a4765c88c7a671cb46fcf3db60a9e140a}


Definition at line 20 of file devfs.\+c.

\hypertarget{devfs_8c_a9af8258c3554800f6613f8147544225f}{\index{devfs.\+c@{devfs.\+c}!vfs\+\_\+root@{vfs\+\_\+root}}
\index{vfs\+\_\+root@{vfs\+\_\+root}!devfs.\+c@{devfs.\+c}}
\subsubsection[{vfs\+\_\+root}]{\setlength{\rightskip}{0pt plus 5cm}{\bf inode\+\_\+t}$\ast$ vfs\+\_\+root}}\label{devfs_8c_a9af8258c3554800f6613f8147544225f}


Definition at line 19 of file vfs.\+c.

