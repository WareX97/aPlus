\hypertarget{iso9660__read_8c}{\section{src/fs/iso9660/iso9660\+\_\+read.c File Reference}
\label{iso9660__read_8c}\index{src/fs/iso9660/iso9660\+\_\+read.\+c@{src/fs/iso9660/iso9660\+\_\+read.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/fs.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
{\ttfamily \#include $<$aplus/spinlock.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include \char`\"{}iso9660.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{iso9660__read_8c_a83af7e892cfc4648261471ecabb77e7b}{iso9660\+\_\+read} (\hyperlink{fs_8h_a48b686d0c4375b0d1aab2296dc36c7a6}{inode\+\_\+t} $\ast$ino, char $\ast$buf, int \hyperlink{mm_8c_a854352f53b148adc24983a58a1866d66}{size})
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{iso9660__read_8c_a83af7e892cfc4648261471ecabb77e7b}{\index{iso9660\+\_\+read.\+c@{iso9660\+\_\+read.\+c}!iso9660\+\_\+read@{iso9660\+\_\+read}}
\index{iso9660\+\_\+read@{iso9660\+\_\+read}!iso9660\+\_\+read.\+c@{iso9660\+\_\+read.\+c}}
\subsubsection[{iso9660\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}int iso9660\+\_\+read (
\begin{DoxyParamCaption}
\item[{{\bf inode\+\_\+t} $\ast$}]{ino, }
\item[{char $\ast$}]{buf, }
\item[{int}]{size}
\end{DoxyParamCaption}
)}}\label{iso9660__read_8c_a83af7e892cfc4648261471ecabb77e7b}


Definition at line 16 of file iso9660\+\_\+read.\+c.



References inode\+::dev, devfs\+\_\+getdevice(), fs\+\_\+read(), I\+S\+O9660\+\_\+\+S\+E\+C\+T\+O\+R\+\_\+\+S\+I\+Z\+E, kfree(), kmalloc(), inode\+::position, inode\+::size, size, uint32\+\_\+t, and inode\+::userdata.


\begin{DoxyCode}
16                                                     \{
17     \textcolor{keywordflow}{if}(!ino)
18         \textcolor{keywordflow}{return} 0;
19         
20     \textcolor{keywordflow}{if}(!buf)
21         \textcolor{keywordflow}{return} 0;
22         
23     \textcolor{keywordflow}{if}(\hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} > ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size})
24         \hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} = ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size};
25         
26     \textcolor{keywordflow}{if}(ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} > ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size})
27         ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} = ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size};
28         
29     \textcolor{keywordflow}{if}(ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} + \hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} > ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size})
30         \hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} = ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size} - ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position};
31         
32     \textcolor{keywordflow}{if}(!\hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size})
33         \textcolor{keywordflow}{return} 0;
34 
35     \hyperlink{structinode}{inode\_t}* dev = (\hyperlink{structinode}{inode\_t}*) \hyperlink{devfs_8c_a226c953aff43f9b1e9736908bb6802f3}{devfs\_getdevice}(ino->
      \hyperlink{structinode_a127a2eb030df332fa64a81188731ad6b}{dev});
36     \textcolor{keywordflow}{if}(!dev)
37         \textcolor{keywordflow}{return} 0;
38 
39     \textcolor{keywordtype}{void}* tbuf = (\textcolor{keywordtype}{void}*) \hyperlink{mm_8h_a1f5d4240b2decc62c0e6eae06c72916c}{kmalloc}(((\hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} / \hyperlink{iso9660_8h_a00bbe26a634a966bc30429348a713ede}{ISO9660\_SECTOR\_SIZE}) + 1) * 
      \hyperlink{iso9660_8h_a00bbe26a634a966bc30429348a713ede}{ISO9660\_SECTOR\_SIZE});
40     
41     dev->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} = (off\_t) ino->\hyperlink{structinode_a8ba627a7ebbacc723e8452fbf8dd3670}{userdata} + (ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} / ISO9660\_SECTOR\_SIZE);
42     \hyperlink{fs_8c_a8e53a98b93e6b136196b2ebd99e43dcd}{fs\_read}(dev, tbuf, ((\hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} / ISO9660\_SECTOR\_SIZE) + 1) * ISO9660\_SECTOR\_SIZE);
43 
44     memcpy(buf, (\textcolor{keywordtype}{void}*) ((\hyperlink{aplus_8h_a53a0df51603c77c2aa5b9ea61b606a82}{uint32\_t}) tbuf + (ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} % ISO9660\_SECTOR\_SIZE)), 
      \hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size});
45     \hyperlink{mm_8h_acee1960bdb3a19cb495341ec725cafef}{kfree}(tbuf);
46 
47     \textcolor{keywordflow}{return} \hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size};
48 \}
\end{DoxyCode}
