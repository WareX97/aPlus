\hypertarget{fcntl_8c}{\section{src/syscall/fcntl.c File Reference}
\label{fcntl_8c}\index{src/syscall/fcntl.\+c@{src/syscall/fcntl.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/fs.\+h$>$}\\*
{\ttfamily \#include $<$aplus/syscall.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{fcntl_8c_a7d46f514aa7d9664ebd2baa4d61c4a37}{sys\+\_\+fcntl} (int fd, int request, void $\ast$buf)
\begin{DoxyCompactList}\small\item\em This function shall perform the operations described below on open files.~\newline
 The available values for cmd are defined in $<$fcntl.\+h$>$ and are as follows. \end{DoxyCompactList}\item 
\hyperlink{fcntl_8c_a5f500fa48a3ec03f7c9627bc1abda1aa}{S\+Y\+S\+C\+A\+L\+L} (\hyperlink{fcntl_8c_a7d46f514aa7d9664ebd2baa4d61c4a37}{sys\+\_\+fcntl}, 19)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{fcntl_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\+\_\+task}
\begin{DoxyCompactList}\small\item\em Current task address. \end{DoxyCompactList}\item 
\hyperlink{fs_8h_a48b686d0c4375b0d1aab2296dc36c7a6}{inode\+\_\+t} $\ast$ \hyperlink{fcntl_8c_a9af8258c3554800f6613f8147544225f}{vfs\+\_\+root}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{fcntl_8c_a7d46f514aa7d9664ebd2baa4d61c4a37}{\index{fcntl.\+c@{fcntl.\+c}!sys\+\_\+fcntl@{sys\+\_\+fcntl}}
\index{sys\+\_\+fcntl@{sys\+\_\+fcntl}!fcntl.\+c@{fcntl.\+c}}
\subsubsection[{sys\+\_\+fcntl}]{\setlength{\rightskip}{0pt plus 5cm}int sys\+\_\+fcntl (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{int}]{request, }
\item[{void $\ast$}]{buf}
\end{DoxyParamCaption}
)}}\label{fcntl_8c_a7d46f514aa7d9664ebd2baa4d61c4a37}


This function shall perform the operations described below on open files.~\newline
 The available values for cmd are defined in $<$fcntl.\+h$>$ and are as follows. 


\begin{DoxyItemize}
\item F\+\_\+\+D\+U\+P\+F\+D~\newline

\begin{DoxyItemize}
\item Return a new file descriptor which shall be the lowest numbered available (that is, not already open) file descriptor greater than or equal to the third argument, arg, taken as an integer of type int.~\newline
 The new file descriptor shall refer to the same open file description as the original file descriptor, and shall share any locks.~\newline
 The F\+D\+\_\+\+C\+L\+O\+E\+X\+E\+C flag associated with the new file descriptor shall be cleared to keep the file open across calls to one of the exec functions.~\newline

\end{DoxyItemize}
\item F\+\_\+\+G\+E\+T\+F\+D~\newline

\begin{DoxyItemize}
\item Get the file descriptor flags defined in $<$fcntl.\+h$>$ that are associated with the file descriptor fildes.~\newline
 File descriptor flags are associated with a single file descriptor and do not affect other file descriptors that refer to the same file.
\end{DoxyItemize}
\item F\+\_\+\+S\+E\+T\+F\+D~\newline

\begin{DoxyItemize}
\item Set the file descriptor flags defined in $<$fcntl.\+h$>$, that are associated with fildes, to the third argument, arg, taken as type int.~\newline
 If the F\+D\+\_\+\+C\+L\+O\+E\+X\+E\+C flag in the third argument is 0, the file shall remain open across the exec functions; otherwise, the file shall be closed upon successful execution of one of the exec functions.~\newline

\end{DoxyItemize}
\item F\+\_\+\+G\+E\+T\+F\+L~\newline

\begin{DoxyItemize}
\item Get the file status flags and file access modes, defined in $<$fcntl.\+h$>$, for the file description associated with fildes. The file access modes can be extracted from the return value using the mask O\+\_\+\+A\+C\+C\+M\+O\+D\+E, which is defined in $<$fcntl.\+h$>$.~\newline
 File status flags and file access modes are associated with the file description and do not affect other file descriptors that refer to the same file with different open file descriptions.~\newline

\end{DoxyItemize}
\item F\+\_\+\+S\+E\+T\+F\+L~\newline

\begin{DoxyItemize}
\item Set the file status flags, defined in $<$fcntl.\+h$>$, for the file description associated with fildes from the corresponding bits in the third argument, arg, taken as type int.~\newline
 Bits corresponding to the file access mode and the file creation flags, as defined in $<$fcntl.\+h$>$, that are set in arg shall be ignored. If any bits in arg other than those mentioned here are changed by the application, the result is unspecified.~\newline

\end{DoxyItemize}
\item F\+\_\+\+G\+E\+T\+O\+W\+N~\newline

\begin{DoxyItemize}
\item If fildes refers to a socket, get the process or process group I\+D specified to receive S\+I\+G\+U\+R\+G signals when out-\/of-\/band data is available.~\newline
 Positive values indicate a process I\+D; negative values, other than -\/1, indicate a process group I\+D.~\newline
 If fildes does not refer to a socket, the results are unspecified.~\newline

\end{DoxyItemize}
\item F\+\_\+\+S\+E\+T\+O\+W\+N~\newline

\begin{DoxyItemize}
\item If fildes refers to a socket, set the process or process group I\+D specified to receive S\+I\+G\+U\+R\+G signals when out-\/of-\/band data is available, using the value of the third argument, arg, taken as type int.~\newline
 Positive values indicate a process I\+D; negative values, other than -\/1, indicate a process group I\+D.~\newline
 If fildes does not refer to a socket, the results are unspecified~\newline
~\newline
~\newline
~\newline
 
\begin{DoxyParams}{Parameters}
{\em fd} & File descriptor. \\
\hline
{\em request} & Request operation. \\
\hline
{\em buf} & Optional arguments. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Upon successful completion, the value returned shall depend on cmd.~\newline
 Otherwise, -\/1 shall be returned and errno set to indicate the error 
\end{DoxyReturn}

\end{DoxyItemize}
\end{DoxyItemize}

Definition at line 72 of file fcntl.\+c.



References errno, task\+::fd, inode\+::position, schedule\+\_\+append\+\_\+fd(), inode\+::size, and T\+A\+S\+K\+\_\+\+M\+A\+X\+\_\+\+F\+D.


\begin{DoxyCode}
72                                               \{
73     \textcolor{keywordflow}{if}(!\hyperlink{fcntl_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
74         \textcolor{keywordflow}{return} -1;
75         
76 
77     \textcolor{keywordflow}{if}(fd < 0 || fd > \hyperlink{task_8h_aa0beab24d02a2ccd5d273dea188af93d}{TASK\_MAX\_FD}) \{
78         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EBADF;
79         \textcolor{keywordflow}{return} -1;
80     \}
81     
82     
83     \hyperlink{structinode}{inode\_t}* ino = \hyperlink{fcntl_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_afeeb6bafaefe505e6a730dd4e0be5a1a}{fd}[fd];
84     \textcolor{keywordflow}{if}(!ino) \{
85         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EBADF;
86         \textcolor{keywordflow}{return} -1;
87     \}
88 
89 
90     \textcolor{keywordflow}{switch}(request) \{
91         \textcolor{keywordflow}{case} F\_DUPFD:
92             \textcolor{keywordflow}{return} \hyperlink{src_2sched_8c_afbffdc5298c98f92960a4fb9ba498063}{schedule\_append\_fd}(\hyperlink{fcntl_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}, ino);
93         \textcolor{keywordflow}{case} F\_GETFD:
94             \textcolor{keywordflow}{return} 0;
95         \textcolor{keywordflow}{case} F\_SETFD:
96             \textcolor{keywordflow}{return} 0;
97         \textcolor{keywordflow}{case} F\_GETFL:
98             \textcolor{keywordflow}{return} 0;
99         \textcolor{keywordflow}{case} F\_SETFL:
100             \textcolor{keywordflow}{switch}((\textcolor{keywordtype}{int})buf) \{
101                 \textcolor{keywordflow}{case} O\_APPEND:
102                     ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} = ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size};
103                     \textcolor{keywordflow}{return} 0;
104                 \textcolor{keywordflow}{case} O\_NONBLOCK:
105                     \textcolor{keywordflow}{return} 0;
106                 \textcolor{keywordflow}{default}:
107                     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EINVAL;
108                     \textcolor{keywordflow}{return} -1;
109             \}
110             \textcolor{keywordflow}{break};
111     \}
112 
113     \textcolor{keywordflow}{return} 0;
114 \}
\end{DoxyCode}
\hypertarget{fcntl_8c_a5f500fa48a3ec03f7c9627bc1abda1aa}{\index{fcntl.\+c@{fcntl.\+c}!S\+Y\+S\+C\+A\+L\+L@{S\+Y\+S\+C\+A\+L\+L}}
\index{S\+Y\+S\+C\+A\+L\+L@{S\+Y\+S\+C\+A\+L\+L}!fcntl.\+c@{fcntl.\+c}}
\subsubsection[{S\+Y\+S\+C\+A\+L\+L}]{\setlength{\rightskip}{0pt plus 5cm}S\+Y\+S\+C\+A\+L\+L (
\begin{DoxyParamCaption}
\item[{{\bf sys\+\_\+fcntl}}]{, }
\item[{19}]{}
\end{DoxyParamCaption}
)}}\label{fcntl_8c_a5f500fa48a3ec03f7c9627bc1abda1aa}


\subsection{Variable Documentation}
\hypertarget{fcntl_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{\index{fcntl.\+c@{fcntl.\+c}!current\+\_\+task@{current\+\_\+task}}
\index{current\+\_\+task@{current\+\_\+task}!fcntl.\+c@{fcntl.\+c}}
\subsubsection[{current\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ current\+\_\+task}}\label{fcntl_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}


Current task address. 



Definition at line 37 of file sched.\+c.

\hypertarget{fcntl_8c_a9af8258c3554800f6613f8147544225f}{\index{fcntl.\+c@{fcntl.\+c}!vfs\+\_\+root@{vfs\+\_\+root}}
\index{vfs\+\_\+root@{vfs\+\_\+root}!fcntl.\+c@{fcntl.\+c}}
\subsubsection[{vfs\+\_\+root}]{\setlength{\rightskip}{0pt plus 5cm}{\bf inode\+\_\+t}$\ast$ vfs\+\_\+root}}\label{fcntl_8c_a9af8258c3554800f6613f8147544225f}


Definition at line 19 of file vfs.\+c.

