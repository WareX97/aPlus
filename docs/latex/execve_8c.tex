\hypertarget{execve_8c}{\section{src/syscall/execve.c File Reference}
\label{execve_8c}\index{src/syscall/execve.\+c@{src/syscall/execve.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
{\ttfamily \#include $<$aplus/syscall.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{execve_8c_af44a7e309f4bd49757f52b4178676ea7}{sys\+\_\+execve} (char $\ast$filename, char $\ast$$\ast$argv, char $\ast$$\ast$\hyperlink{environ_8c_aa006daaf11f1e2e45a6ababaf463212b}{environ})
\begin{DoxyCompactList}\small\item\em Executes the program pointed to by filename.~\newline
 filename must be either a binary executable, or a script starting with a line of the form.~\newline
 \#! interpreter \mbox{[}optional-\/arg\mbox{]}. \end{DoxyCompactList}\item 
\hyperlink{execve_8c_ad7d0c3131e92bac14e1e9ac6b73f6ec8}{S\+Y\+S\+C\+A\+L\+L} (\hyperlink{execve_8c_af44a7e309f4bd49757f52b4178676ea7}{sys\+\_\+execve}, 2)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\+\_\+task}
\begin{DoxyCompactList}\small\item\em Current task address. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{execve_8c_af44a7e309f4bd49757f52b4178676ea7}{\index{execve.\+c@{execve.\+c}!sys\+\_\+execve@{sys\+\_\+execve}}
\index{sys\+\_\+execve@{sys\+\_\+execve}!execve.\+c@{execve.\+c}}
\subsubsection[{sys\+\_\+execve}]{\setlength{\rightskip}{0pt plus 5cm}int sys\+\_\+execve (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{filename, }
\item[{char $\ast$$\ast$}]{argv, }
\item[{char $\ast$$\ast$}]{environ}
\end{DoxyParamCaption}
)}}\label{execve_8c_af44a7e309f4bd49757f52b4178676ea7}


Executes the program pointed to by filename.~\newline
 filename must be either a binary executable, or a script starting with a line of the form.~\newline
 \#! interpreter \mbox{[}optional-\/arg\mbox{]}. 


\begin{DoxyParams}{Parameters}
{\em filename} & executable path. \\
\hline
{\em argv} & Is an array of argument strings passed to the new program.~\newline
 By convention, the first of these strings should contain the filename associated with the file being executed. \\
\hline
{\em environ} & Is an array of strings, conventionally of the form key=value, which are passed as environment to the new program. \\
\hline
\end{DoxyParams}
\begin{DoxyWarning}{Warning}
Both argv and environ must be terminated by a null pointer. 
\end{DoxyWarning}
\begin{DoxyReturn}{Returns}
Does not return on success, and the text, data, bss, and stack of the calling process are overwritten by that of the program loaded. 
\end{DoxyReturn}


Definition at line 27 of file execve.\+c.



References task\+::argv, elf32\+\_\+load(), environ, task\+::envp, errno, task\+::exe, task\+::fd, kfree(), kmalloc(), size, sys\+\_\+close(), sys\+\_\+lseek(), sys\+\_\+open(), and sys\+\_\+read().


\begin{DoxyCode}
27                                                             \{
28     
29     \textcolor{keywordtype}{int} fd = \hyperlink{open_8c_ab7835c4352479c7a3d7af78c138e81c1}{sys\_open}(filename, O\_RDONLY, 0644);
30     \textcolor{keywordflow}{if}(fd < 0) \{
31         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOENT;
32         \textcolor{keywordflow}{return} -1;
33     \}
34 
35     \hyperlink{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}{sys\_lseek}(fd, 0, SEEK\_END);
36     \textcolor{keywordtype}{size\_t} \hyperlink{iso9660_8h_ae5dc6ffcd9b7605c7787791e40cc6bb0}{size} = \hyperlink{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}{sys\_lseek}(fd, 0, SEEK\_CUR);
37     \hyperlink{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}{sys\_lseek}(fd, 0, SEEK\_SET);
38 
39     \textcolor{keywordtype}{void}* image = \hyperlink{mm_8h_a1f5d4240b2decc62c0e6eae06c72916c}{kmalloc}(size);
40     \textcolor{keywordflow}{if}(!image) \{
41         \hyperlink{close_8c_a9d94cbe3ac3c59ac54d9e884a024d9c5}{sys\_close}(fd);
42 
43         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOMEM;
44         \textcolor{keywordflow}{return} -1;
45     \}
46 
47     \textcolor{keywordflow}{if}(\hyperlink{read_8c_a508cbee9c162869815810e15a3d0e1b0}{sys\_read}(fd, image, size) < size) \{
48         \hyperlink{close_8c_a9d94cbe3ac3c59ac54d9e884a024d9c5}{sys\_close}(fd);
49         \hyperlink{mm_8h_acee1960bdb3a19cb495341ec725cafef}{kfree}(image);
50         
51         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EIO;
52         \textcolor{keywordflow}{return} -1;
53     \}
54 
55     
56 
57     void (*entry) () = (\textcolor{keywordtype}{void} (*) ()) \hyperlink{exec_8c_a7473eb0ac8edeee7e0a7502c5ed08dc8}{elf32\_load}(image);
58     \textcolor{keywordflow}{if}(entry) \{
59 
60         \hyperlink{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a22a59fcfc18d5f671340669f96571768}{exe} = \hyperlink{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_afeeb6bafaefe505e6a730dd4e0be5a1a}{fd}[fd];
61         \hyperlink{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a91e7540d20695c7439f7d0755a7a0545}{argv} = argv;
62         \hyperlink{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a09fbc78d666a0b49e2e2064121d28364}{envp} = \hyperlink{crt0_8c_aa006daaf11f1e2e45a6ababaf463212b}{environ};
63 
64         \hyperlink{close_8c_a9d94cbe3ac3c59ac54d9e884a024d9c5}{sys\_close}(fd);
65 
66 
67         entry(); \textcolor{comment}{/* never return */}
68     \}
69 
70     \hyperlink{close_8c_a9d94cbe3ac3c59ac54d9e884a024d9c5}{sys\_close}(fd);
71     \hyperlink{mm_8h_acee1960bdb3a19cb495341ec725cafef}{kfree}(image);
72     \textcolor{keywordflow}{return} -1;
73 \}
\end{DoxyCode}
\hypertarget{execve_8c_ad7d0c3131e92bac14e1e9ac6b73f6ec8}{\index{execve.\+c@{execve.\+c}!S\+Y\+S\+C\+A\+L\+L@{S\+Y\+S\+C\+A\+L\+L}}
\index{S\+Y\+S\+C\+A\+L\+L@{S\+Y\+S\+C\+A\+L\+L}!execve.\+c@{execve.\+c}}
\subsubsection[{S\+Y\+S\+C\+A\+L\+L}]{\setlength{\rightskip}{0pt plus 5cm}S\+Y\+S\+C\+A\+L\+L (
\begin{DoxyParamCaption}
\item[{{\bf sys\+\_\+execve}}]{, }
\item[{2}]{}
\end{DoxyParamCaption}
)}}\label{execve_8c_ad7d0c3131e92bac14e1e9ac6b73f6ec8}


\subsection{Variable Documentation}
\hypertarget{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{\index{execve.\+c@{execve.\+c}!current\+\_\+task@{current\+\_\+task}}
\index{current\+\_\+task@{current\+\_\+task}!execve.\+c@{execve.\+c}}
\subsubsection[{current\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ current\+\_\+task}}\label{execve_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}


Current task address. 



Definition at line 35 of file sched.\+c.

