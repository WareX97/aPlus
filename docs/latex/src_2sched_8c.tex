\hypertarget{src_2sched_8c}{\section{src/sched.c File Reference}
\label{src_2sched_8c}\index{src/sched.\+c@{src/sched.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
{\ttfamily \#include $<$aplus/fs.\+h$>$}\\*
{\ttfamily \#include $<$aplus/spinlock.\+h$>$}\\*
{\ttfamily \#include $<$aplus/mm.\+h$>$}\\*
{\ttfamily \#include $<$aplus/list.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{src_2sched_8c_a11eb67cd27beaf272f76796f65d1ca1c}{im\+\_\+superuser} ()
\begin{DoxyCompactList}\small\item\em Get root permissions for current task. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a736a4d44542e7f4d0e231002cb7ddb8d}{schedule\+\_\+enable} ()
\begin{DoxyCompactList}\small\item\em Enable scheduling. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a5018bd63e4a7d4dd926e06faf1b7513d}{schedule\+\_\+disable} ()
\begin{DoxyCompactList}\small\item\em Disable scheduling. \end{DoxyCompactList}\item 
pid\+\_\+t \hyperlink{src_2sched_8c_a986fa43e945f396a2c722a1f766e03c8}{schedule\+\_\+nextpid} ()
\begin{DoxyCompactList}\small\item\em Get a new Process I\+D. \end{DoxyCompactList}\item 
int \hyperlink{src_2sched_8c_a9f6f16348da2348d320d255437e6ac02}{schedule\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em Initialize scheduling. \end{DoxyCompactList}\item 
static \hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{src_2sched_8c_a94a683ba0ad510a6d51f369bb4496147}{schedule\+\_\+next} ()
\begin{DoxyCompactList}\small\item\em Get next ready task. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a7d06701ac073c331c83519e3909b7fce}{schedule} ()
\begin{DoxyCompactList}\small\item\em Perform a scheduling and check T\+T\+L (Time To Live) for current task. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a4002881c26790c4390e314ce0e1ef1e8}{schedule\+\_\+yield} ()
\begin{DoxyCompactList}\small\item\em Perform a forced scheduling. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a878aa3454133f7c01a4ba15ef68b9be2}{schedule\+\_\+setpriority} (int priority)
\begin{DoxyCompactList}\small\item\em Set T\+T\+L (Time To Live) for current task. \end{DoxyCompactList}\item 
int \hyperlink{src_2sched_8c_a74e91e3418aedd28c8ddf5d150859a70}{schedule\+\_\+wait} (\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$child)
\begin{DoxyCompactList}\small\item\em Wait for child. \end{DoxyCompactList}\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{src_2sched_8c_a96793377662f91213568fe44bf4eccad}{schedule\+\_\+child} ()
\begin{DoxyCompactList}\small\item\em Get Child task for current task. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a5a770047741113d76251f4d75c4e5612}{schedule\+\_\+exit2} (\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$\hyperlink{structtask}{task}, int status)
\begin{DoxyCompactList}\small\item\em Terminate a task with an Exit Value. \end{DoxyCompactList}\item 
void \hyperlink{src_2sched_8c_a38866ec6f9b163355973a41f15248ab1}{schedule\+\_\+exit} (int status)
\begin{DoxyCompactList}\small\item\em Terminate current task. \end{DoxyCompactList}\item 
pid\+\_\+t \hyperlink{src_2sched_8c_abfd87543f692b5543a89246bd8fbe456}{schedule\+\_\+getpid} ()
\begin{DoxyCompactList}\small\item\em Get Process I\+D of current task. \end{DoxyCompactList}\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{src_2sched_8c_afcc9c5ea77b2a3aaafc7bdf896d9d633}{schedule\+\_\+getbypid} (pid\+\_\+t pid)
\begin{DoxyCompactList}\small\item\em Get task from his Process I\+D. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{src_2sched_8c_a5af6764b80e6b9a24df59f7bb636f3d4}{schedule\+\_\+sbrk} (ptrdiff\+\_\+t increment)
\begin{DoxyCompactList}\small\item\em Increment address space of current task. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\+\_\+task}
\begin{DoxyCompactList}\small\item\em Current task address. \end{DoxyCompactList}\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{src_2sched_8c_ac08620610e2419aca3878305400a96b7}{kernel\+\_\+task}
\begin{DoxyCompactList}\small\item\em Kernel task address. \end{DoxyCompactList}\item 
\hyperlink{list_8h_af629e6a6713d7de11eab50cbe6449b06}{list\+\_\+t} $\ast$ \hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\+\_\+queue}
\begin{DoxyCompactList}\small\item\em List of all Task. \end{DoxyCompactList}\item 
static int \hyperlink{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}{sched\+\_\+enabled} = 0
\begin{DoxyCompactList}\small\item\em Scheduling enabled status. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{src_2sched_8c_a11eb67cd27beaf272f76796f65d1ca1c}{\index{src/sched.\+c@{src/sched.\+c}!im\+\_\+superuser@{im\+\_\+superuser}}
\index{im\+\_\+superuser@{im\+\_\+superuser}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{im\+\_\+superuser}]{\setlength{\rightskip}{0pt plus 5cm}int im\+\_\+superuser (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a11eb67cd27beaf272f76796f65d1ca1c}


Get root permissions for current task. 

\begin{DoxyReturn}{Returns}
true or false. 
\end{DoxyReturn}


Definition at line 58 of file sched.\+c.



References task\+::gid, G\+I\+D\+\_\+\+S\+U\+P\+E\+R\+U\+S\+E\+R, task\+::uid, and U\+I\+D\+\_\+\+S\+U\+P\+E\+R\+U\+S\+E\+R.


\begin{DoxyCode}
58                    \{
59     \textcolor{keywordflow}{if}(!\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
60         \textcolor{keywordflow}{return} -1;
61 
62     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task} == \hyperlink{src_2sched_8c_ac08620610e2419aca3878305400a96b7}{kernel\_task})
63         \textcolor{keywordflow}{return} 1;
64         
65     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_ade8fc4c414bce856dacf9efee3031be8}{uid} == \hyperlink{task_8h_a14338e391bef80aa10d476348d085c5c}{UID\_SUPERUSER} && 
      \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_aaf3b6e15445e766a5c4823b815bca630}{gid} == \hyperlink{task_8h_a6120fde6185466f2810fd0457009aaf0}{GID\_SUPERUSER})
66         \textcolor{keywordflow}{return} 1;
67     \textcolor{keywordflow}{else}
68         \textcolor{keywordflow}{return} 0;
69 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a7d06701ac073c331c83519e3909b7fce}{\index{src/sched.\+c@{src/sched.\+c}!schedule@{schedule}}
\index{schedule@{schedule}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule}]{\setlength{\rightskip}{0pt plus 5cm}void schedule (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a7d06701ac073c331c83519e3909b7fce}


Perform a scheduling and check T\+T\+L (Time To Live) for current task. 



Definition at line 133 of file sched.\+c.



References task\+::clock, list\+\_\+empty(), task\+::priority, sched\+\_\+enabled, schedule\+\_\+next(), task\+::signal\+\_\+handler, task\+::signal\+\_\+sig, and task\+\_\+switch().


\begin{DoxyCode}
133                 \{
134     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}{sched\_enabled} == 0)
135         \textcolor{keywordflow}{return};
136         
137     \textcolor{keywordflow}{if}(\hyperlink{list_8h_a89e0fc8ca134e1dceb33c75b756e6754}{list\_empty}(\hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue}))
138         \textcolor{keywordflow}{return};
139 
140 
141     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3d6991558f05258094bbef5c47073928}{signal\_sig}) \{
142         \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_aea4c9382e5f4f148a0a74c0680729cf0}{signal\_handler}) \{
143             \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_aea4c9382e5f4f148a0a74c0680729cf0}{signal\_handler}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->
      \hyperlink{structtask_a3d6991558f05258094bbef5c47073928}{signal\_sig});
144             \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3d6991558f05258094bbef5c47073928}{signal\_sig} = 0;
145         \}
146     \}
147         
148 
149 
150     \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a8a31c6648c1b1869bfa069f4a969b0ad}{clock} += 1;
151     
152     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a8a31c6648c1b1869bfa069f4a969b0ad}{clock} % \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a9ab46b5a6e7c471f1fe32db13e6636a2}{priority})
153         \textcolor{keywordflow}{return};
154 
155     
156     \hyperlink{task_8c_a1b2086f34fd20264fae9ed90c4bc2645}{task\_switch}(\hyperlink{src_2sched_8c_a94a683ba0ad510a6d51f369bb4496147}{schedule\_next}());
157 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a96793377662f91213568fe44bf4eccad}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+child@{schedule\+\_\+child}}
\index{schedule\+\_\+child@{schedule\+\_\+child}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+child}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ schedule\+\_\+child (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a96793377662f91213568fe44bf4eccad}


Get Child task for current task. 

\begin{DoxyReturn}{Returns}
child task or N\+U\+L\+L in case of error. 
\end{DoxyReturn}


Definition at line 203 of file sched.\+c.



References list\+\_\+foreach, task\+::parent, and value.


\begin{DoxyCode}
203                          \{
204     \textcolor{keywordflow}{if}(!\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
205         \textcolor{keywordflow}{return} NULL;
206         
207 
208     \hyperlink{list_8h_a1f44c976d2c698407a17fef984a5b232}{list\_foreach}(\hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value}, \hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue}) \{
209         \hyperlink{structtask}{task\_t}* child = (\hyperlink{structtask}{task\_t}*) \hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value};
210         
211         \textcolor{keywordflow}{if}(child->\hyperlink{structtask_a34c6613744820a1e8127756fb6a5392c}{parent} == \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
212             \textcolor{keywordflow}{return} child;
213     \}
214     
215     \textcolor{keywordflow}{return} NULL;
216 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a5018bd63e4a7d4dd926e06faf1b7513d}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+disable@{schedule\+\_\+disable}}
\index{schedule\+\_\+disable@{schedule\+\_\+disable}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+disable}]{\setlength{\rightskip}{0pt plus 5cm}void schedule\+\_\+disable (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a5018bd63e4a7d4dd926e06faf1b7513d}


Disable scheduling. 



Definition at line 82 of file sched.\+c.



References sched\+\_\+enabled.


\begin{DoxyCode}
82                         \{
83     \hyperlink{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}{sched\_enabled} = 0;
84 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a736a4d44542e7f4d0e231002cb7ddb8d}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+enable@{schedule\+\_\+enable}}
\index{schedule\+\_\+enable@{schedule\+\_\+enable}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+enable}]{\setlength{\rightskip}{0pt plus 5cm}void schedule\+\_\+enable (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a736a4d44542e7f4d0e231002cb7ddb8d}


Enable scheduling. 



Definition at line 75 of file sched.\+c.



References sched\+\_\+enabled.


\begin{DoxyCode}
75                        \{
76     \hyperlink{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}{sched\_enabled} = 1;
77 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a38866ec6f9b163355973a41f15248ab1}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+exit@{schedule\+\_\+exit}}
\index{schedule\+\_\+exit@{schedule\+\_\+exit}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+exit}]{\setlength{\rightskip}{0pt plus 5cm}void schedule\+\_\+exit (
\begin{DoxyParamCaption}
\item[{int}]{status}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a38866ec6f9b163355973a41f15248ab1}


Terminate current task. 


\begin{DoxyParams}{Parameters}
{\em status} & Exit Value. \\
\hline
\end{DoxyParams}
\begin{DoxySeeAlso}{See also}
\hyperlink{src_2sched_8c_a5a770047741113d76251f4d75c4e5612}{schedule\+\_\+exit2} 
\end{DoxySeeAlso}


Definition at line 244 of file sched.\+c.



References schedule\+\_\+exit2().


\begin{DoxyCode}
244                                \{
245     \hyperlink{src_2sched_8c_a5a770047741113d76251f4d75c4e5612}{schedule\_exit2}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}, status);
246 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a5a770047741113d76251f4d75c4e5612}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+exit2@{schedule\+\_\+exit2}}
\index{schedule\+\_\+exit2@{schedule\+\_\+exit2}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+exit2}]{\setlength{\rightskip}{0pt plus 5cm}void schedule\+\_\+exit2 (
\begin{DoxyParamCaption}
\item[{{\bf task\+\_\+t} $\ast$}]{task, }
\item[{int}]{status}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a5a770047741113d76251f4d75c4e5612}


Terminate a task with an Exit Value. 


\begin{DoxyParams}{Parameters}
{\em task} & Task to close. \\
\hline
{\em status} & Exit Value. \\
\hline
\end{DoxyParams}


Definition at line 223 of file sched.\+c.



References kfree(), list\+\_\+remove(), schedule\+\_\+yield(), T\+A\+S\+K\+\_\+\+S\+T\+A\+T\+E\+\_\+\+D\+E\+A\+D, and vmm\+\_\+free().


\begin{DoxyCode}
223                                               \{
224     \textcolor{keywordflow}{if}(!task)
225         \textcolor{keywordflow}{return};
226         
227     \hyperlink{list_8h_a4470c240b622941415ae5250067699b5}{list\_remove}(\hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue}, (\hyperlink{list_8h_a83bc1af7566502e08756b8d8c425972e}{listval\_t}) task);
228         
229     task->\hyperlink{structtask_a09ebd490ccb87f169fd7c3d8d95b4f39}{state} = \hyperlink{task_8h_aea18b04c3c7d46195bab375efc1f61b6}{TASK\_STATE\_DEAD};
230     task->\hyperlink{structtask_a9bd7bbd83fe1f4744c76ff240b6da5db}{exitcode} = status;
231     
232     \hyperlink{mm_8h_acee1960bdb3a19cb495341ec725cafef}{kfree}((\textcolor{keywordtype}{void}*) task->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_afbc0623ab058e402e92ea084dc37ab6a}{ptr});
233     \hyperlink{paging_8c_a2840d14db66d94b76ebcf3adf3e971e0}{vmm\_free}(task->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_a340cbedbdc4b542793e7677dd4966ade}{vaddr}, task->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_aa90dc3e7e232d6ba3f04700b3197b366}{length});
234 
235     \hyperlink{src_2sched_8c_a4002881c26790c4390e314ce0e1ef1e8}{schedule\_yield}();
236 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_afcc9c5ea77b2a3aaafc7bdf896d9d633}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+getbypid@{schedule\+\_\+getbypid}}
\index{schedule\+\_\+getbypid@{schedule\+\_\+getbypid}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+getbypid}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ schedule\+\_\+getbypid (
\begin{DoxyParamCaption}
\item[{pid\+\_\+t}]{pid}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_afcc9c5ea77b2a3aaafc7bdf896d9d633}


Get task from his Process I\+D. 

\begin{DoxyReturn}{Returns}
Task or N\+U\+L\+L in case of error. 
\end{DoxyReturn}


Definition at line 265 of file sched.\+c.



References current\+\_\+task, list\+\_\+foreach, task\+::pid, and value.


\begin{DoxyCode}
265                                      \{
266     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_ab56448ae42a75825ea923bd86648f3ae}{pid} == pid)
267         \textcolor{keywordflow}{return} \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task};
268         
269     \hyperlink{list_8h_a1f44c976d2c698407a17fef984a5b232}{list\_foreach}(\hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value}, \hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue}) \{
270         \hyperlink{structtask}{task\_t}* t = (\hyperlink{structtask}{task\_t}*) \hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value};
271         
272         \textcolor{keywordflow}{if}(t->\hyperlink{structtask_ab56448ae42a75825ea923bd86648f3ae}{pid} == pid)
273             \textcolor{keywordflow}{return} t;
274     \}
275     
276     \textcolor{keywordflow}{return} NULL;
277 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_abfd87543f692b5543a89246bd8fbe456}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+getpid@{schedule\+\_\+getpid}}
\index{schedule\+\_\+getpid@{schedule\+\_\+getpid}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+getpid}]{\setlength{\rightskip}{0pt plus 5cm}pid\+\_\+t schedule\+\_\+getpid (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_abfd87543f692b5543a89246bd8fbe456}


Get Process I\+D of current task. 

\begin{DoxyReturn}{Returns}
Process I\+D or -\/1 in case of error. 
\end{DoxyReturn}


Definition at line 253 of file sched.\+c.



References task\+::pid.


\begin{DoxyCode}
253                         \{
254     \textcolor{keywordflow}{if}(!\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
255         \textcolor{keywordflow}{return} -1;
256         
257     \textcolor{keywordflow}{return} \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_ab56448ae42a75825ea923bd86648f3ae}{pid};
258 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a9f6f16348da2348d320d255437e6ac02}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+init@{schedule\+\_\+init}}
\index{schedule\+\_\+init@{schedule\+\_\+init}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}int schedule\+\_\+init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a9f6f16348da2348d320d255437e6ac02}


Initialize scheduling. 

\begin{DoxyReturn}{Returns}
success of initilization. 
\end{DoxyReturn}


Definition at line 100 of file sched.\+c.



References list\+\_\+init, schedule\+\_\+enable(), and task\+\_\+init().


\begin{DoxyCode}
100                     \{
101     \hyperlink{list_8h_aa288c0785df071ed8643763202928c82}{list\_init}(\hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue});
102     \hyperlink{task_8c_a30500c422833c90d6f42e44e2efb04a7}{task\_init}();
103     
104     
105     \hyperlink{src_2sched_8c_a736a4d44542e7f4d0e231002cb7ddb8d}{schedule\_enable}();
106     \textcolor{keywordflow}{return} 0;
107 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a94a683ba0ad510a6d51f369bb4496147}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+next@{schedule\+\_\+next}}
\index{schedule\+\_\+next@{schedule\+\_\+next}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+next}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf task\+\_\+t}$\ast$ schedule\+\_\+next (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{src_2sched_8c_a94a683ba0ad510a6d51f369bb4496147}


Get next ready task. 

\begin{DoxyReturn}{Returns}
A ready task to schedule. 
\end{DoxyReturn}


Definition at line 114 of file sched.\+c.



References current\+\_\+task, list\+\_\+head(), list\+\_\+next(), task\+::state, and T\+A\+S\+K\+\_\+\+S\+T\+A\+T\+E\+\_\+\+A\+L\+I\+V\+E.


\begin{DoxyCode}
114                                \{
115     
116     \hyperlink{structtask}{task\_t}* newtask = \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task};
117     
118     \textcolor{keywordflow}{do} \{
119         newtask = (\hyperlink{structtask}{task\_t}*) \hyperlink{list_8h_abcd4418be12b04265c44dd69a1cfee1f}{list\_next}(\hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue}, (
      \hyperlink{list_8h_a83bc1af7566502e08756b8d8c425972e}{listval\_t}) newtask);
120         \textcolor{keywordflow}{if}(!newtask)
121             newtask = (\hyperlink{structtask}{task\_t}*) \hyperlink{list_8h_a0c1ce6a6a566dc1db394540f5bf65149}{list\_head}(\hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue});
122         
123     \} \textcolor{keywordflow}{while}(newtask->\hyperlink{structtask_a09ebd490ccb87f169fd7c3d8d95b4f39}{state} != \hyperlink{task_8h_a447252ba92918fc13f5b6fd120b2656f}{TASK\_STATE\_ALIVE});
124 
125     
126     \textcolor{keywordflow}{return} newtask;
127 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a986fa43e945f396a2c722a1f766e03c8}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+nextpid@{schedule\+\_\+nextpid}}
\index{schedule\+\_\+nextpid@{schedule\+\_\+nextpid}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+nextpid}]{\setlength{\rightskip}{0pt plus 5cm}pid\+\_\+t schedule\+\_\+nextpid (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a986fa43e945f396a2c722a1f766e03c8}


Get a new Process I\+D. 



Definition at line 89 of file sched.\+c.


\begin{DoxyCode}
89                          \{
90     \textcolor{keyword}{static} pid\_t nextpid = 0;
91     \textcolor{keywordflow}{return} nextpid++;
92 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a5af6764b80e6b9a24df59f7bb636f3d4}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+sbrk@{schedule\+\_\+sbrk}}
\index{schedule\+\_\+sbrk@{schedule\+\_\+sbrk}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+sbrk}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ schedule\+\_\+sbrk (
\begin{DoxyParamCaption}
\item[{ptrdiff\+\_\+t}]{increment}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a5af6764b80e6b9a24df59f7bb636f3d4}


Increment address space of current task. 


\begin{DoxyParams}{Parameters}
{\em increment} & Increment in Bytes. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Current size of address space or N\+U\+L\+L in case of error. 
\end{DoxyReturn}


Definition at line 284 of file sched.\+c.



References task\+::image, task\+::length, uint32\+\_\+t, task\+::vaddr, vmm\+\_\+alloc(), V\+M\+M\+\_\+\+F\+L\+A\+G\+S\+\_\+\+D\+E\+F\+A\+U\+L\+T, V\+M\+M\+\_\+\+F\+L\+A\+G\+S\+\_\+\+U\+S\+E\+R, and vmm\+\_\+free().


\begin{DoxyCode}
284                                          \{
285     \textcolor{keywordflow}{if}(!\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
286         \textcolor{keywordflow}{return} NULL;
287         
288     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_a340cbedbdc4b542793e7677dd4966ade}{vaddr} == 0)
289         \textcolor{keywordflow}{return} NULL;
290 
291 
292 
293     \textcolor{keywordtype}{void}* brk = (\textcolor{keywordtype}{void}*) ((\hyperlink{aplus_8h_a53a0df51603c77c2aa5b9ea61b606a82}{uint32\_t}) \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.
      \hyperlink{structtask_a340cbedbdc4b542793e7677dd4966ade}{vaddr} + \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_aa90dc3e7e232d6ba3f04700b3197b366}{length});        
294     \textcolor{keywordflow}{if}(increment == 0)
295         \textcolor{keywordflow}{return} brk;
296 
297 
298     increment = (increment & ~0xFFF) + 0x1000;
299 
300     \textcolor{keywordflow}{if}(increment > 0)
301         \hyperlink{paging_8c_aebed4a90dd887506ed125f9efb953c93}{vmm\_alloc}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_a340cbedbdc4b542793e7677dd4966ade}{vaddr} + 
      \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_aa90dc3e7e232d6ba3f04700b3197b366}{length}, increment, \hyperlink{mm_8h_ab630ce3a249eeb08c1242b082f4e50ce}{VMM\_FLAGS\_DEFAULT} | 
      \hyperlink{mm_8h_a4f995b267ef97c4638c27370badecb21}{VMM\_FLAGS\_USER});
302     \textcolor{keywordflow}{else}
303         \hyperlink{paging_8c_a2840d14db66d94b76ebcf3adf3e971e0}{vmm\_free}(\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_a340cbedbdc4b542793e7677dd4966ade}{vaddr} + 
      \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_aa90dc3e7e232d6ba3f04700b3197b366}{length}, increment);  
304 
305     \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a3eac6c8a544ff49a836c5eed9ec48107}{image}.\hyperlink{structtask_aa90dc3e7e232d6ba3f04700b3197b366}{length} += increment;
306 
307     \textcolor{keywordflow}{return} brk;
308 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a878aa3454133f7c01a4ba15ef68b9be2}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+setpriority@{schedule\+\_\+setpriority}}
\index{schedule\+\_\+setpriority@{schedule\+\_\+setpriority}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+setpriority}]{\setlength{\rightskip}{0pt plus 5cm}void schedule\+\_\+setpriority (
\begin{DoxyParamCaption}
\item[{int}]{priority}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a878aa3454133f7c01a4ba15ef68b9be2}


Set T\+T\+L (Time To Live) for current task. 


\begin{DoxyParams}{Parameters}
{\em priority} & T\+T\+L for current task. \\
\hline
\end{DoxyParams}


Definition at line 178 of file sched.\+c.



References task\+::priority.


\begin{DoxyCode}
178                                         \{
179     \textcolor{keywordflow}{if}(!\hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
180         \textcolor{keywordflow}{return};
181         
182     \hyperlink{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_a9ab46b5a6e7c471f1fe32db13e6636a2}{priority} = priority;
183 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a74e91e3418aedd28c8ddf5d150859a70}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+wait@{schedule\+\_\+wait}}
\index{schedule\+\_\+wait@{schedule\+\_\+wait}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+wait}]{\setlength{\rightskip}{0pt plus 5cm}int schedule\+\_\+wait (
\begin{DoxyParamCaption}
\item[{{\bf task\+\_\+t} $\ast$}]{child}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a74e91e3418aedd28c8ddf5d150859a70}


Wait for child. 


\begin{DoxyParams}{Parameters}
{\em child} & Task to wait. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Exit value of child or -\/1 in case of error. 
\end{DoxyReturn}


Definition at line 191 of file sched.\+c.



References task\+::exitcode, spinlock\+\_\+waiton, task\+::state, and T\+A\+S\+K\+\_\+\+S\+T\+A\+T\+E\+\_\+\+D\+E\+A\+D.


\begin{DoxyCode}
191                                  \{
192     \textcolor{keywordflow}{if}(!child)
193         \textcolor{keywordflow}{return} -1;
194         
195     \hyperlink{spinlock_8h_a9fd2288887ae3bf29520677b29e010a3}{spinlock\_waiton}(child->\hyperlink{structtask_a09ebd490ccb87f169fd7c3d8d95b4f39}{state} != \hyperlink{task_8h_aea18b04c3c7d46195bab375efc1f61b6}{TASK\_STATE\_DEAD});
196     \textcolor{keywordflow}{return} child->\hyperlink{structtask_a9bd7bbd83fe1f4744c76ff240b6da5db}{exitcode};
197 \}
\end{DoxyCode}
\hypertarget{src_2sched_8c_a4002881c26790c4390e314ce0e1ef1e8}{\index{src/sched.\+c@{src/sched.\+c}!schedule\+\_\+yield@{schedule\+\_\+yield}}
\index{schedule\+\_\+yield@{schedule\+\_\+yield}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{schedule\+\_\+yield}]{\setlength{\rightskip}{0pt plus 5cm}void schedule\+\_\+yield (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{src_2sched_8c_a4002881c26790c4390e314ce0e1ef1e8}


Perform a forced scheduling. 



Definition at line 163 of file sched.\+c.



References list\+\_\+empty(), sched\+\_\+enabled, schedule\+\_\+next(), and task\+\_\+switch().


\begin{DoxyCode}
163                       \{
164     \textcolor{keywordflow}{if}(\hyperlink{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}{sched\_enabled} == 0)
165         \textcolor{keywordflow}{return};
166         
167     \textcolor{keywordflow}{if}(\hyperlink{list_8h_a89e0fc8ca134e1dceb33c75b756e6754}{list\_empty}(\hyperlink{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{task\_queue}))
168         \textcolor{keywordflow}{return};
169         
170     \hyperlink{task_8c_a1b2086f34fd20264fae9ed90c4bc2645}{task\_switch}(\hyperlink{src_2sched_8c_a94a683ba0ad510a6d51f369bb4496147}{schedule\_next}());
171 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{\index{src/sched.\+c@{src/sched.\+c}!current\+\_\+task@{current\+\_\+task}}
\index{current\+\_\+task@{current\+\_\+task}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{current\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ current\+\_\+task}}\label{src_2sched_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}


Current task address. 



Definition at line 35 of file sched.\+c.

\hypertarget{src_2sched_8c_ac08620610e2419aca3878305400a96b7}{\index{src/sched.\+c@{src/sched.\+c}!kernel\+\_\+task@{kernel\+\_\+task}}
\index{kernel\+\_\+task@{kernel\+\_\+task}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{kernel\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ kernel\+\_\+task}}\label{src_2sched_8c_ac08620610e2419aca3878305400a96b7}


Kernel task address. 



Definition at line 40 of file sched.\+c.

\hypertarget{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}{\index{src/sched.\+c@{src/sched.\+c}!sched\+\_\+enabled@{sched\+\_\+enabled}}
\index{sched\+\_\+enabled@{sched\+\_\+enabled}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{sched\+\_\+enabled}]{\setlength{\rightskip}{0pt plus 5cm}int sched\+\_\+enabled = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{src_2sched_8c_aeb00dca46bca400ba3512e70f9a1c55c}


Scheduling enabled status. 



Definition at line 52 of file sched.\+c.

\hypertarget{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}{\index{src/sched.\+c@{src/sched.\+c}!task\+\_\+queue@{task\+\_\+queue}}
\index{task\+\_\+queue@{task\+\_\+queue}!src/sched.\+c@{src/sched.\+c}}
\subsubsection[{task\+\_\+queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf list\+\_\+t}$\ast$ task\+\_\+queue}}\label{src_2sched_8c_acb74842176b48d2ab29b1a74b0ca4ef1}


List of all Task. 



Definition at line 46 of file sched.\+c.

