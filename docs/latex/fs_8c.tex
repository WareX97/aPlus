\hypertarget{fs_8c}{\section{src/fs/fs.c File Reference}
\label{fs_8c}\index{src/fs/fs.\+c@{src/fs/fs.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/fs.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$stddef.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{fs_8c_a8e53a98b93e6b136196b2ebd99e43dcd}{fs\+\_\+read} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$ptr, int len)
\item 
int \hyperlink{fs_8c_a7d87cba454ac1212bfc2277b5792bf95}{fs\+\_\+write} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$ptr, int len)
\item 
struct \hyperlink{structdirent}{dirent} $\ast$ \hyperlink{fs_8c_af6320f9253c5bd1f298876fdbe41b9de}{fs\+\_\+readdir} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, int index)
\item 
struct \hyperlink{structinode}{inode} $\ast$ \hyperlink{fs_8c_ad8edcff785980ccbc26c887c19ac8989}{fs\+\_\+finddir} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$\hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name})
\item 
struct \hyperlink{structinode}{inode} $\ast$ \hyperlink{fs_8c_a8973117250569528548e2c2ff3f6e44e}{fs\+\_\+creat} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$\hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name}, mode\+\_\+t mode)
\item 
int \hyperlink{fs_8c_a23db0b0dd4f66cd2cc34a9116164cfc4}{fs\+\_\+rename} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$oldname, char $\ast$newname)
\item 
int \hyperlink{fs_8c_ab0e4dd01b14f5ba2495318b840acdfff}{fs\+\_\+unlink} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, char $\ast$\hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name})
\item 
int \hyperlink{fs_8c_a2928203c42eba392963b57bfed7b65c4}{fs\+\_\+chown} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, uid\+\_\+t owner, gid\+\_\+t group)
\item 
void \hyperlink{fs_8c_a37ebdb2a9963f0f89d938fa2cc5d78df}{fs\+\_\+flush} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode})
\item 
int \hyperlink{fs_8c_afb548bce2f916933a7c7d95a48b57cdb}{fs\+\_\+ioctl} (struct \hyperlink{structinode}{inode} $\ast$\hyperlink{structinode}{inode}, int req, void $\ast$buf)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{fs_8c_a2928203c42eba392963b57bfed7b65c4}{\index{fs.\+c@{fs.\+c}!fs\+\_\+chown@{fs\+\_\+chown}}
\index{fs\+\_\+chown@{fs\+\_\+chown}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+chown}]{\setlength{\rightskip}{0pt plus 5cm}int fs\+\_\+chown (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{uid\+\_\+t}]{owner, }
\item[{gid\+\_\+t}]{group}
\end{DoxyParamCaption}
)}}\label{fs_8c_a2928203c42eba392963b57bfed7b65c4}


Definition at line 93 of file fs.\+c.



References inode\+::chown, and errno.


\begin{DoxyCode}
93                                                              \{
94     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_a8221183a697c9f2b4e0e295f5a9d8afd}{chown})
95         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_a8221183a697c9f2b4e0e295f5a9d8afd}{chown}(inode, owner, group);
96         
97     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
98     \textcolor{keywordflow}{return} -1;
99 \}
\end{DoxyCode}
\hypertarget{fs_8c_a8973117250569528548e2c2ff3f6e44e}{\index{fs.\+c@{fs.\+c}!fs\+\_\+creat@{fs\+\_\+creat}}
\index{fs\+\_\+creat@{fs\+\_\+creat}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+creat}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf inode}$\ast$ fs\+\_\+creat (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{name, }
\item[{mode\+\_\+t}]{mode}
\end{DoxyParamCaption}
)}}\label{fs_8c_a8973117250569528548e2c2ff3f6e44e}


Definition at line 69 of file fs.\+c.



References inode\+::creat, and errno.


\begin{DoxyCode}
69                                                                       \{
70     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_ad622a049b34780786d9ba4311b06b3b4}{creat})
71         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_ad622a049b34780786d9ba4311b06b3b4}{creat}(inode, \hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name}, mode);
72     
73     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;        
74     \textcolor{keywordflow}{return} NULL;
75 \}
\end{DoxyCode}
\hypertarget{fs_8c_ad8edcff785980ccbc26c887c19ac8989}{\index{fs.\+c@{fs.\+c}!fs\+\_\+finddir@{fs\+\_\+finddir}}
\index{fs\+\_\+finddir@{fs\+\_\+finddir}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+finddir}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf inode}$\ast$ fs\+\_\+finddir (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fs_8c_ad8edcff785980ccbc26c887c19ac8989}


Definition at line 50 of file fs.\+c.



References errno, inode\+::finddir, inode\+::parent, and vfs\+\_\+mapped().


\begin{DoxyCode}
50                                                            \{
51 
52     \textcolor{keywordflow}{if}(strcmp(\hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name}, \textcolor{stringliteral}{"."}) == 0)
53         \textcolor{keywordflow}{return} inode;
54 
55     \textcolor{keywordflow}{if}(strcmp(\hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name}, \textcolor{stringliteral}{".."}) == 0)
56         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_a2d4fac4ae14332628e6fa2bd55dd3121}{parent};
57 
58     \hyperlink{structinode}{inode\_t}* map = NULL;
59     \textcolor{keywordflow}{if}((map = (\hyperlink{structinode}{inode\_t}*) \hyperlink{vfs_8c_a99334446cfc1dfc32088d838b4f2895c}{vfs\_mapped}(inode, \hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name})) != NULL)
60         \textcolor{keywordflow}{return} map;
61 
62     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_ab6c5e2d912fdbd506086e53185cd370d}{finddir})
63         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_ab6c5e2d912fdbd506086e53185cd370d}{finddir}(inode, \hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name});
64         
65     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
66     \textcolor{keywordflow}{return} NULL;
67 \}
\end{DoxyCode}
\hypertarget{fs_8c_a37ebdb2a9963f0f89d938fa2cc5d78df}{\index{fs.\+c@{fs.\+c}!fs\+\_\+flush@{fs\+\_\+flush}}
\index{fs\+\_\+flush@{fs\+\_\+flush}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+flush}]{\setlength{\rightskip}{0pt plus 5cm}void fs\+\_\+flush (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode}
\end{DoxyParamCaption}
)}}\label{fs_8c_a37ebdb2a9963f0f89d938fa2cc5d78df}


Definition at line 101 of file fs.\+c.



References errno, and inode\+::flush.


\begin{DoxyCode}
101                                    \{
102     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_ae2972ef183f5c39aac7cb83b9f8a04a8}{flush})
103         inode->\hyperlink{structinode_ae2972ef183f5c39aac7cb83b9f8a04a8}{flush}(inode);
104         
105     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
106     \textcolor{keywordflow}{return};
107 \}
\end{DoxyCode}
\hypertarget{fs_8c_afb548bce2f916933a7c7d95a48b57cdb}{\index{fs.\+c@{fs.\+c}!fs\+\_\+ioctl@{fs\+\_\+ioctl}}
\index{fs\+\_\+ioctl@{fs\+\_\+ioctl}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+ioctl}]{\setlength{\rightskip}{0pt plus 5cm}int fs\+\_\+ioctl (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{int}]{req, }
\item[{void $\ast$}]{buf}
\end{DoxyParamCaption}
)}}\label{fs_8c_afb548bce2f916933a7c7d95a48b57cdb}


Definition at line 109 of file fs.\+c.



References errno, and inode\+::ioctl.


\begin{DoxyCode}
109                                                       \{
110     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_a636843da203574bc338b016758bf8c7e}{ioctl})
111         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_a636843da203574bc338b016758bf8c7e}{ioctl}(inode, req, buf);
112     
113     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
114     \textcolor{keywordflow}{return} -1;
115 \}
\end{DoxyCode}
\hypertarget{fs_8c_a8e53a98b93e6b136196b2ebd99e43dcd}{\index{fs.\+c@{fs.\+c}!fs\+\_\+read@{fs\+\_\+read}}
\index{fs\+\_\+read@{fs\+\_\+read}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}int fs\+\_\+read (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{ptr, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fs_8c_a8e53a98b93e6b136196b2ebd99e43dcd}


Definition at line 16 of file fs.\+c.



References errno, and inode\+::read.


\begin{DoxyCode}
16                                                       \{
17     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_ae2c5e8a0a372334b97024fbd9ef694c1}{read})
18         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_ae2c5e8a0a372334b97024fbd9ef694c1}{read}(inode, ptr, len);
19     
20     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;        
21     \textcolor{keywordflow}{return} 0;
22 \}
\end{DoxyCode}
\hypertarget{fs_8c_af6320f9253c5bd1f298876fdbe41b9de}{\index{fs.\+c@{fs.\+c}!fs\+\_\+readdir@{fs\+\_\+readdir}}
\index{fs\+\_\+readdir@{fs\+\_\+readdir}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+readdir}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf dirent}$\ast$ fs\+\_\+readdir (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{int}]{index}
\end{DoxyParamCaption}
)}}\label{fs_8c_af6320f9253c5bd1f298876fdbe41b9de}


Definition at line 32 of file fs.\+c.



References dirent\+::d\+\_\+ino, dirent\+::d\+\_\+name, errno, inode\+::ino, kmalloc(), inode\+::name, inode\+::readdir, vfs\+\_\+mapped\+\_\+at\+\_\+index(), and vfs\+\_\+mapped\+\_\+count().


\begin{DoxyCode}
32                                                            \{
33 
34     \hyperlink{structinode}{inode\_t}* map = NULL;
35     \textcolor{keywordflow}{if}((map = (\hyperlink{structinode}{inode\_t}*) \hyperlink{vfs_8c_a4f7b5f17ac7c4b3a0a574d9620e0512d}{vfs\_mapped\_at\_index}(inode, index)) != NULL) \{
36         \textcolor{keyword}{struct }\hyperlink{structdirent}{dirent}* ent = (\textcolor{keyword}{struct }\hyperlink{structdirent}{dirent}*) \hyperlink{mm_8h_a1f5d4240b2decc62c0e6eae06c72916c}{kmalloc}(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structdirent}{dirent}));
37         strcpy(ent->\hyperlink{structdirent_a39a9af609c1808f0bdf90155bd3f55ed}{d\_name}, map->\hyperlink{structinode_ad64802d9d4ebdd1c56af5ab6e302faf0}{name});
38         ent->\hyperlink{structdirent_aef01e92a29cba347e6e6a5f22d4908a2}{d\_ino} = map->\hyperlink{structinode_a1a77be0f24a6c9a18bbdbcecfb75df7c}{ino};
39         
40         \textcolor{keywordflow}{return} ent;
41     \}
42 
43     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_a0a54c11571f19f23322f3e6ad3ecb113}{readdir})
44         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_a0a54c11571f19f23322f3e6ad3ecb113}{readdir}(inode, index - \hyperlink{vfs_8c_a829e1c063db610c46554db0e28cb2bcb}{vfs\_mapped\_count}(inode));
45         
46     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
47     \textcolor{keywordflow}{return} NULL;
48 \}
\end{DoxyCode}
\hypertarget{fs_8c_a23db0b0dd4f66cd2cc34a9116164cfc4}{\index{fs.\+c@{fs.\+c}!fs\+\_\+rename@{fs\+\_\+rename}}
\index{fs\+\_\+rename@{fs\+\_\+rename}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+rename}]{\setlength{\rightskip}{0pt plus 5cm}int fs\+\_\+rename (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{oldname, }
\item[{char $\ast$}]{newname}
\end{DoxyParamCaption}
)}}\label{fs_8c_a23db0b0dd4f66cd2cc34a9116164cfc4}


Definition at line 77 of file fs.\+c.



References errno, and inode\+::rename.


\begin{DoxyCode}
77                                                                   \{
78     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_a5a309a9c4ada7e4d062162b06125a929}{rename})
79         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_a5a309a9c4ada7e4d062162b06125a929}{rename}(inode, oldname, newname);
80     
81     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;        
82     \textcolor{keywordflow}{return} -1;
83 \}
\end{DoxyCode}
\hypertarget{fs_8c_ab0e4dd01b14f5ba2495318b840acdfff}{\index{fs.\+c@{fs.\+c}!fs\+\_\+unlink@{fs\+\_\+unlink}}
\index{fs\+\_\+unlink@{fs\+\_\+unlink}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+unlink}]{\setlength{\rightskip}{0pt plus 5cm}int fs\+\_\+unlink (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fs_8c_ab0e4dd01b14f5ba2495318b840acdfff}


Definition at line 85 of file fs.\+c.



References errno, and inode\+::unlink.


\begin{DoxyCode}
85                                                 \{
86     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_adf65bac80736631b8000d3d34e953aaa}{unlink})
87         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_adf65bac80736631b8000d3d34e953aaa}{unlink}(inode, \hyperlink{attribute_8h_aae08e5b919f01beb6c69d2859e0dfc27}{name});
88         
89     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
90     \textcolor{keywordflow}{return} -1;
91 \}
\end{DoxyCode}
\hypertarget{fs_8c_a7d87cba454ac1212bfc2277b5792bf95}{\index{fs.\+c@{fs.\+c}!fs\+\_\+write@{fs\+\_\+write}}
\index{fs\+\_\+write@{fs\+\_\+write}!fs.\+c@{fs.\+c}}
\subsubsection[{fs\+\_\+write}]{\setlength{\rightskip}{0pt plus 5cm}int fs\+\_\+write (
\begin{DoxyParamCaption}
\item[{struct {\bf inode} $\ast$}]{inode, }
\item[{char $\ast$}]{ptr, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fs_8c_a7d87cba454ac1212bfc2277b5792bf95}


Definition at line 24 of file fs.\+c.



References errno, and inode\+::write.


\begin{DoxyCode}
24                                                        \{
25     \textcolor{keywordflow}{if}(inode->\hyperlink{structinode_a53a123d38834fa17e7ef5c1e5f47bba2}{write})
26         \textcolor{keywordflow}{return} inode->\hyperlink{structinode_a53a123d38834fa17e7ef5c1e5f47bba2}{write}(inode, ptr, len);
27         
28     \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOSYS;    
29     \textcolor{keywordflow}{return} 0;
30 \}
\end{DoxyCode}
