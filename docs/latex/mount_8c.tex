\hypertarget{mount_8c}{\section{Riferimenti per il file src/syscall/mount.c}
\label{mount_8c}\index{src/syscall/mount.\+c@{src/syscall/mount.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/fs.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
{\ttfamily \#include $<$aplus/list.\+h$>$}\\*
{\ttfamily \#include $<$aplus/attribute.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
\subsection*{Funzioni}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{mount_8c_adbb2f2f41fa719d188b9291a25afdd98}{sys\+\_\+mount} (const char $\ast$dev, const char $\ast$dir, const char $\ast$fstype, int options, const void $\ast$data)
\end{DoxyCompactItemize}
\subsection*{Variabili}
\begin{DoxyCompactItemize}
\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{mount_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\+\_\+task}
\end{DoxyCompactItemize}


\subsection{Documentazione delle funzioni}
\hypertarget{mount_8c_adbb2f2f41fa719d188b9291a25afdd98}{\index{mount.\+c@{mount.\+c}!sys\+\_\+mount@{sys\+\_\+mount}}
\index{sys\+\_\+mount@{sys\+\_\+mount}!mount.\+c@{mount.\+c}}
\subsubsection[{sys\+\_\+mount}]{\setlength{\rightskip}{0pt plus 5cm}int sys\+\_\+mount (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{dev, }
\item[{const char $\ast$}]{dir, }
\item[{const char $\ast$}]{fstype, }
\item[{int}]{options, }
\item[{const void $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{mount_8c_adbb2f2f41fa719d188b9291a25afdd98}


Definizione alla linea 20 del file mount.\+c.



Referenzia attribute(), inode\+::dev, errno, task\+::fd, im\+\_\+superuser(), inode\+::ino, list\+\_\+destroy, list\+\_\+empty(), list\+\_\+foreach, inode\+::mode, fs\+::mount, fs\+::name, O\+\_\+\+D\+I\+R\+E\+C\+T\+O\+R\+Y, sys\+\_\+close(), sys\+\_\+open(), e value.


\begin{DoxyCode}
20                                                                                                    \{
21     \textcolor{keywordflow}{if}(!\hyperlink{mount_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task})
22         \textcolor{keywordflow}{return} -1;
23 
24 
25     \textcolor{keywordflow}{if}(!\hyperlink{src_2sched_8c_a11eb67cd27beaf272f76796f65d1ca1c}{im\_superuser}()) \{
26         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EPERM;
27         \textcolor{keywordflow}{return} -1;
28     \}
29 
30 
31     \textcolor{keywordflow}{if}(dir == NULL || strlen(dir) == 0) \{
32         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EINVAL;
33         \textcolor{keywordflow}{return} -1;
34     \}
35 
36     \hyperlink{structinode}{inode\_t}* idev = NULL;
37     \hyperlink{structinode}{inode\_t}* idir = NULL;
38 
39 
40     \textcolor{keywordflow}{if}(dev && strlen(dev) > 0) \{
41         \textcolor{keywordtype}{int} dfd = \hyperlink{open_8c_ab7835c4352479c7a3d7af78c138e81c1}{sys\_open}(dev, O\_RDONLY, 0644);
42         \textcolor{keywordflow}{if}(dfd < 0) \{
43             \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOENT;
44             \textcolor{keywordflow}{return} -1;
45         \}
46 
47         idev = \hyperlink{mount_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_afeeb6bafaefe505e6a730dd4e0be5a1a}{fd}[dfd];
48         \hyperlink{close_8c_a9d94cbe3ac3c59ac54d9e884a024d9c5}{sys\_close}(dfd);
49     \}
50 
51 
52     \textcolor{keywordtype}{int} sfd = \hyperlink{open_8c_ab7835c4352479c7a3d7af78c138e81c1}{sys\_open}(dir, O\_CREAT | \hyperlink{dirent_8h_a6afd3dd2f570069804b40e6aa24fc966}{O\_DIRECTORY} | O\_RDONLY, S\_IFDIR);
53     \textcolor{keywordflow}{if}(sfd < 0) \{
54         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENOENT;
55         \textcolor{keywordflow}{return} -1;
56     \}
57 
58     idir = \hyperlink{mount_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_afeeb6bafaefe505e6a730dd4e0be5a1a}{fd}[sfd];
59     \hyperlink{close_8c_a9d94cbe3ac3c59ac54d9e884a024d9c5}{sys\_close}(sfd);
60 
61     \hyperlink{structlist}{list\_t}* \hyperlink{structfs}{fs} = \hyperlink{attribute_8h_ab96abe3fdf944e75a2316807105c1b6e}{attribute}(\textcolor{stringliteral}{"fs"});
62     \textcolor{keywordflow}{if}(\hyperlink{list_8h_a89e0fc8ca134e1dceb33c75b756e6754}{list\_empty}(fs)) \{
63         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENODEV;
64         \textcolor{keywordflow}{return} -1;
65     \}
66     
67 
68     \hyperlink{structfs}{fs\_t}* found = NULL;
69 
70     \hyperlink{list_8h_a1f44c976d2c698407a17fef984a5b232}{list\_foreach}(\hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value}, fs) \{
71         \hyperlink{structfs}{fs\_t}* f = (\hyperlink{structfs}{fs\_t}*) \hyperlink{attribute_8h_ae7f66047e6e39ba2bb6af8b95f00d1dd}{value};
72 
73         \textcolor{keywordflow}{if}(strcmp(f->\hyperlink{structfs_a7d1c966e58722afdf537c5d7bc0790c7}{name}, fstype) == 0)
74             found = f;
75     \}
76 
77     \hyperlink{list_8h_a9c676c5a77ee9c18ccaadcb4f99fc990}{list\_destroy}(fs);
78 
79     \textcolor{keywordflow}{if}(found == NULL) \{
80         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = ENODEV;
81         \textcolor{keywordflow}{return} -1;
82     \}
83 
84     idir->\hyperlink{structinode_a4902d9f6a1d7bd79c6f1bb73d83ce8e3}{mode} |= S\_IFMT;
85     idir->\hyperlink{structinode_a127a2eb030df332fa64a81188731ad6b}{dev} = idev->\hyperlink{structinode_a1a77be0f24a6c9a18bbdbcecfb75df7c}{ino};
86 
87     \textcolor{keywordflow}{return} found->\hyperlink{structfs_a6ae33214a489b396e834ac7e028d859c}{mount}(idev, idir, options);
88 \}
\end{DoxyCode}


\subsection{Documentazione delle variabili}
\hypertarget{mount_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{\index{mount.\+c@{mount.\+c}!current\+\_\+task@{current\+\_\+task}}
\index{current\+\_\+task@{current\+\_\+task}!mount.\+c@{mount.\+c}}
\subsubsection[{current\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ current\+\_\+task}}\label{mount_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}


Definizione alla linea 33 del file sched.\+c.

