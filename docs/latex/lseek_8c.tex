\hypertarget{lseek_8c}{\section{src/syscall/lseek.c File Reference}
\label{lseek_8c}\index{src/syscall/lseek.\+c@{src/syscall/lseek.\+c}}
}
{\ttfamily \#include $<$aplus.\+h$>$}\\*
{\ttfamily \#include $<$aplus/syscall.\+h$>$}\\*
{\ttfamily \#include $<$aplus/fs.\+h$>$}\\*
{\ttfamily \#include $<$aplus/task.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$dirent.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}{sys\+\_\+lseek} (int fd, int pos, int dir)
\item 
\hyperlink{lseek_8c_adf9807ac9976dd75922da3de250cf9b1}{S\+Y\+S\+C\+A\+L\+L} (\hyperlink{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}{sys\+\_\+lseek}, 9)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{task_8h_a8aeef2cdb643462b97cd459a8e68cad3}{task\+\_\+t} $\ast$ \hyperlink{lseek_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\+\_\+task}
\begin{DoxyCompactList}\small\item\em Current task address. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}{\index{lseek.\+c@{lseek.\+c}!sys\+\_\+lseek@{sys\+\_\+lseek}}
\index{sys\+\_\+lseek@{sys\+\_\+lseek}!lseek.\+c@{lseek.\+c}}
\subsubsection[{sys\+\_\+lseek}]{\setlength{\rightskip}{0pt plus 5cm}int sys\+\_\+lseek (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{int}]{pos, }
\item[{int}]{dir}
\end{DoxyParamCaption}
)}}\label{lseek_8c_a73c739226f6bf069953b03bdc19e15d6}


Definition at line 18 of file lseek.\+c.



References errno, task\+::fd, inode\+::position, inode\+::size, and T\+A\+S\+K\+\_\+\+M\+A\+X\+\_\+\+F\+D.


\begin{DoxyCode}
18                                         \{
19 
20     \textcolor{keywordflow}{if}(fd < 0 || fd > \hyperlink{task_8h_aa0beab24d02a2ccd5d273dea188af93d}{TASK\_MAX\_FD}) \{
21         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EBADF;
22         \textcolor{keywordflow}{return} -1;
23     \}
24     
25 
26     \hyperlink{structinode}{inode\_t}* ino = \hyperlink{lseek_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{current\_task}->\hyperlink{structtask_afeeb6bafaefe505e6a730dd4e0be5a1a}{fd}[fd];
27     \textcolor{keywordflow}{if}(!ino) \{
28         \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EBADF;
29         \textcolor{keywordflow}{return} -1;
30     \}
31     
32     
33     \textcolor{keywordflow}{if}(pos > ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size})
34         pos = ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size};
35     
36     \textcolor{keywordflow}{switch}(dir) \{
37         \textcolor{keywordflow}{case} SEEK\_SET:
38             ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} = pos;
39             \textcolor{keywordflow}{break};
40         \textcolor{keywordflow}{case} SEEK\_END:
41             ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} = ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size} - pos;
42             \textcolor{keywordflow}{break};
43         \textcolor{keywordflow}{case} SEEK\_CUR:
44             ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} = (ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} + pos > ino->\hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size} ? ino->
      \hyperlink{structinode_a53722b1b60b7136ce0204b66527bb400}{size} : ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position} + pos);
45             \textcolor{keywordflow}{break};
46         \textcolor{keywordflow}{default}:
47             \hyperlink{errno_8c_ad65a8842cc674e3ddf69355898c0ecbf}{errno} = EINVAL;
48             \textcolor{keywordflow}{return} -1;
49     \}
50     
51     \textcolor{keywordflow}{return} ino->\hyperlink{structinode_a5756f61233e40d01652094d29b5daf6c}{position};
52 \}
\end{DoxyCode}
\hypertarget{lseek_8c_adf9807ac9976dd75922da3de250cf9b1}{\index{lseek.\+c@{lseek.\+c}!S\+Y\+S\+C\+A\+L\+L@{S\+Y\+S\+C\+A\+L\+L}}
\index{S\+Y\+S\+C\+A\+L\+L@{S\+Y\+S\+C\+A\+L\+L}!lseek.\+c@{lseek.\+c}}
\subsubsection[{S\+Y\+S\+C\+A\+L\+L}]{\setlength{\rightskip}{0pt plus 5cm}S\+Y\+S\+C\+A\+L\+L (
\begin{DoxyParamCaption}
\item[{{\bf sys\+\_\+lseek}}]{, }
\item[{9}]{}
\end{DoxyParamCaption}
)}}\label{lseek_8c_adf9807ac9976dd75922da3de250cf9b1}


\subsection{Variable Documentation}
\hypertarget{lseek_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}{\index{lseek.\+c@{lseek.\+c}!current\+\_\+task@{current\+\_\+task}}
\index{current\+\_\+task@{current\+\_\+task}!lseek.\+c@{lseek.\+c}}
\subsubsection[{current\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}{\bf task\+\_\+t}$\ast$ current\+\_\+task}}\label{lseek_8c_a4743b3673a8794b8e7bd0b6c91a63cd5}


Current task address. 



Definition at line 37 of file sched.\+c.

